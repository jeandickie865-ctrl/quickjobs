{"dependencies":[{"name":"./distance","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":109},"end":{"line":4,"column":47,"index":156}}],"key":"iycZ8wRItk4OOQEBVmvrrq3ooL8=","exportNames":["*"],"imports":1}},{"name":"./normalizeAddress","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":157},"end":{"line":5,"column":54,"index":211}}],"key":"m3UysYDWsYidjBqN8dpi7aXnojU=","exportNames":["*"],"imports":1}},{"name":"../types/address","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":212},"end":{"line":6,"column":49,"index":261}}],"key":"RVJOe6JSBSaA+pZyb/fapuHyuxI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.nearbyJobs = nearbyJobs;\n  var _distance = require(_dependencyMap[0], \"./distance\");\n  var _normalizeAddress = require(_dependencyMap[1], \"./normalizeAddress\");\n  var _typesAddress = require(_dependencyMap[2], \"../types/address\");\n  // utils/nearbyJobs.ts\n\n  const SPECIAL_SECURITY = \"Sachkunde nach § 34a GewO\";\n  /**\n   * Get jobs near the worker with distance info and disabled state\n   * @param jobs All jobs\n   * @param worker Worker profile\n   * @param maxDistanceKm Optional max distance (defaults to worker's radius or 30km)\n   * @returns Sorted list of jobs with distance and disabled state\n   */\n  function nearbyJobs(jobs, worker, maxDistanceKm) {\n    const workerRadius = worker.radiusKm ?? 30;\n    const maxDistance = maxDistanceKm ?? workerRadius;\n    const workerSkills = worker.selectedTags ?? [];\n    return jobs.map(job => {\n      // Calculate distance\n      const distance = (0, _distance.calculateDistance)({\n        lat: job.lat,\n        lon: job.lon\n      }, {\n        lat: worker.homeLat,\n        lon: worker.homeLon\n      });\n\n      // Check if job requires 34a and worker doesn't have it\n      const requires34a = job.required_all_tags?.includes(SPECIAL_SECURITY) && !workerSkills.includes(SPECIAL_SECURITY);\n\n      // Determine disabled state and reason\n      let disabled = false;\n      let disabledReason;\n      if (distance > maxDistance) {\n        disabled = true;\n        disabledReason = \"Außerhalb deines Radius\";\n      } else if (requires34a) {\n        disabled = true;\n        disabledReason = \"Erfordert Sachkunde § 34a\";\n      }\n\n      // Normalize address\n      const normalizedAddress = (0, _typesAddress.formatAddress)(job.address, true) || (0, _normalizeAddress.normalizeAddress)(job.address?.city || \"\");\n      return Object.assign({}, job, {\n        distance,\n        normalizedAddress,\n        disabled,\n        disabledReason\n      });\n    }).sort((a, b) => a.distance - b.distance); // Sort by distance (closest first)\n  }\n});","lineCount":59,"map":[[7,2,24,0,"exports"],[7,9,24,0],[7,10,24,0,"nearbyJobs"],[7,20,24,0],[7,23,24,0,"nearbyJobs"],[7,33,24,0],[8,2,4,0],[8,6,4,0,"_distance"],[8,15,4,0],[8,18,4,0,"require"],[8,25,4,0],[8,26,4,0,"_dependencyMap"],[8,40,4,0],[9,2,5,0],[9,6,5,0,"_normalizeAddress"],[9,23,5,0],[9,26,5,0,"require"],[9,33,5,0],[9,34,5,0,"_dependencyMap"],[9,48,5,0],[10,2,6,0],[10,6,6,0,"_typesAddress"],[10,19,6,0],[10,22,6,0,"require"],[10,29,6,0],[10,30,6,0,"_dependencyMap"],[10,44,6,0],[11,2,1,0],[13,2,8,0],[13,8,8,6,"SPECIAL_SECURITY"],[13,24,8,22],[13,27,8,25],[13,54,8,52],[14,2,17,0],[15,0,18,0],[16,0,19,0],[17,0,20,0],[18,0,21,0],[19,0,22,0],[20,0,23,0],[21,2,24,7],[21,11,24,16,"nearbyJobs"],[21,21,24,26,"nearbyJobs"],[21,22,25,2,"jobs"],[21,26,25,13],[21,28,26,2,"worker"],[21,34,26,23],[21,36,27,2,"maxDistanceKm"],[21,49,27,24],[21,51,28,15],[22,4,29,2],[22,10,29,8,"workerRadius"],[22,22,29,20],[22,25,29,23,"worker"],[22,31,29,29],[22,32,29,30,"radiusKm"],[22,40,29,38],[22,44,29,42],[22,46,29,44],[23,4,30,2],[23,10,30,8,"maxDistance"],[23,21,30,19],[23,24,30,22,"maxDistanceKm"],[23,37,30,35],[23,41,30,39,"workerRadius"],[23,53,30,51],[24,4,32,2],[24,10,32,8,"workerSkills"],[24,22,32,20],[24,25,32,23,"worker"],[24,31,32,29],[24,32,32,30,"selectedTags"],[24,44,32,42],[24,48,32,46],[24,50,32,48],[25,4,34,2],[25,11,34,9,"jobs"],[25,15,34,13],[25,16,35,5,"map"],[25,19,35,8],[25,20,35,9,"job"],[25,23,35,12],[25,27,35,16],[26,6,36,6],[27,6,37,6],[27,12,37,12,"distance"],[27,20,37,20],[27,23,37,23],[27,27,37,23,"calculateDistance"],[27,36,37,40],[27,37,37,40,"calculateDistance"],[27,54,37,40],[27,56,38,8],[28,8,38,10,"lat"],[28,11,38,13],[28,13,38,15,"job"],[28,16,38,18],[28,17,38,19,"lat"],[28,20,38,22],[29,8,38,24,"lon"],[29,11,38,27],[29,13,38,29,"job"],[29,16,38,32],[29,17,38,33,"lon"],[30,6,38,37],[30,7,38,38],[30,9,39,8],[31,8,39,10,"lat"],[31,11,39,13],[31,13,39,15,"worker"],[31,19,39,21],[31,20,39,22,"homeLat"],[31,27,39,29],[32,8,39,31,"lon"],[32,11,39,34],[32,13,39,36,"worker"],[32,19,39,42],[32,20,39,43,"homeLon"],[33,6,39,51],[33,7,40,6],[33,8,40,7],[35,6,42,6],[36,6,43,6],[36,12,43,12,"requires34a"],[36,23,43,23],[36,26,44,8,"job"],[36,29,44,11],[36,30,44,12,"required_all_tags"],[36,47,44,29],[36,49,44,31,"includes"],[36,57,44,39],[36,58,44,40,"SPECIAL_SECURITY"],[36,74,44,56],[36,75,44,57],[36,79,45,8],[36,80,45,9,"workerSkills"],[36,92,45,21],[36,93,45,22,"includes"],[36,101,45,30],[36,102,45,31,"SPECIAL_SECURITY"],[36,118,45,47],[36,119,45,48],[38,6,47,6],[39,6,48,6],[39,10,48,10,"disabled"],[39,18,48,18],[39,21,48,21],[39,26,48,26],[40,6,49,6],[40,10,49,10,"disabledReason"],[40,24,49,44],[41,6,51,6],[41,10,51,10,"distance"],[41,18,51,18],[41,21,51,21,"maxDistance"],[41,32,51,32],[41,34,51,34],[42,8,52,8,"disabled"],[42,16,52,16],[42,19,52,19],[42,23,52,23],[43,8,53,8,"disabledReason"],[43,22,53,22],[43,25,53,25],[43,50,53,50],[44,6,54,6],[44,7,54,7],[44,13,54,13],[44,17,54,17,"requires34a"],[44,28,54,28],[44,30,54,30],[45,8,55,8,"disabled"],[45,16,55,16],[45,19,55,19],[45,23,55,23],[46,8,56,8,"disabledReason"],[46,22,56,22],[46,25,56,25],[46,52,56,52],[47,6,57,6],[49,6,59,6],[50,6,60,6],[50,12,60,12,"normalizedAddress"],[50,29,60,29],[50,32,60,32],[50,36,60,32,"formatAddress"],[50,49,60,45],[50,50,60,45,"formatAddress"],[50,63,60,45],[50,65,60,46,"job"],[50,68,60,49],[50,69,60,50,"address"],[50,76,60,57],[50,78,60,59],[50,82,60,63],[50,83,60,64],[50,87,61,32],[50,91,61,32,"normalizeAddress"],[50,108,61,48],[50,109,61,48,"normalizeAddress"],[50,125,61,48],[50,127,61,49,"job"],[50,130,61,52],[50,131,61,53,"address"],[50,138,61,60],[50,140,61,62,"city"],[50,144,61,66],[50,148,61,70],[50,150,61,72],[50,151,61,73],[51,6,63,6],[51,13,63,6,"Object"],[51,19,63,6],[51,20,63,6,"assign"],[51,26,63,6],[51,31,64,11,"job"],[51,34,64,14],[52,8,65,8,"distance"],[52,16,65,16],[53,8,66,8,"normalizedAddress"],[53,25,66,25],[54,8,67,8,"disabled"],[54,16,67,16],[55,8,68,8,"disabledReason"],[56,6,68,22],[57,4,70,4],[57,5,70,5],[57,6,70,6],[57,7,71,5,"sort"],[57,11,71,9],[57,12,71,10],[57,13,71,11,"a"],[57,14,71,12],[57,16,71,14,"b"],[57,17,71,15],[57,22,71,20,"a"],[57,23,71,21],[57,24,71,22,"distance"],[57,32,71,30],[57,35,71,33,"b"],[57,36,71,34],[57,37,71,35,"distance"],[57,45,71,43],[57,46,71,44],[57,47,71,45],[57,48,71,46],[58,2,72,0],[59,0,72,1],[59,3]],"functionMap":{"names":["<global>","nearbyJobs","jobs.map$argument_0","jobs.map.sort$argument_0"],"mappings":"AAA;OCuB;SCW;KDmC;UEC,iCF;CDC"},"hasCjsExports":false},"type":"js/module"}]}
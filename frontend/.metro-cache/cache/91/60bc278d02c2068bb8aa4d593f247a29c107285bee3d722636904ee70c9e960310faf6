{"dependencies":[{"name":"./distance","data":{"asyncType":null,"locs":[{"start":{"line":4,"column":0,"index":151},"end":{"line":4,"column":47,"index":198}}],"key":"PELdPg2i15Jj9QyfWW57qUZbbLk="}},{"name":"./normalizeAddress","data":{"asyncType":null,"locs":[{"start":{"line":5,"column":0,"index":199},"end":{"line":5,"column":54,"index":253}}],"key":"IpBp9W+nDdXuVsmcC7tCEtvYns0="}},{"name":"../types/address","data":{"asyncType":null,"locs":[{"start":{"line":6,"column":0,"index":254},"end":{"line":6,"column":49,"index":303}}],"key":"SElAU3qFV4/WFeitMu3KteK5nmY="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.nearbyJobs = nearbyJobs;\n  var _distance = require(_dependencyMap[0], \"./distance\");\n  var _normalizeAddress = require(_dependencyMap[1], \"./normalizeAddress\");\n  var _address = require(_dependencyMap[2], \"../types/address\");\n  // utils/nearbyJobs.ts - MATCHING 2.2 (Extended Security Checks)\n\n  // Security Tags (alle werden geprüft)\n  const SECURITY_SACHKUNDE = \"Sachkunde nach § 34a GewO\";\n  const SECURITY_UNTERRICHTUNG = \"Unterrichtung nach § 34a GewO\";\n  const SECURITY_BEWACHER_ID = \"Bewacher-ID\";\n  const SECURITY_FUEHRUNGSZEUGNIS = \"Polizeiliches Führungszeugnis\";\n  /**\n   * Get jobs near the worker with distance info and disabled state\n   * MATCHING 2.0 - Simple nearby jobs view\n   */\n  function nearbyJobs(jobs, worker) {\n    const workerSkills = worker.selectedTags || [];\n    return jobs.map(job => {\n      // Calculate distance\n      const distance = (0, _distance.calculateDistance)({\n        lat: job.lat,\n        lon: job.lon\n      }, {\n        lat: worker.homeLat,\n        lon: worker.homeLon\n      });\n\n      // Check all security requirements (MATCHING 2.2)\n      const jobTags = job.required_all_tags || [];\n      let missingSecuritySkill;\n\n      // Sachkunde §34a\n      if (jobTags.includes(SECURITY_SACHKUNDE) && !workerSkills.includes(SECURITY_SACHKUNDE)) {\n        missingSecuritySkill = \"Sachkunde § 34a\";\n      }\n\n      // Unterrichtung §34a (oder Sachkunde)\n      if (jobTags.includes(SECURITY_UNTERRICHTUNG)) {\n        const hasUnterrichtung = workerSkills.includes(SECURITY_UNTERRICHTUNG);\n        const hasSachkunde = workerSkills.includes(SECURITY_SACHKUNDE);\n        if (!hasUnterrichtung && !hasSachkunde) {\n          missingSecuritySkill = \"Unterrichtung § 34a\";\n        }\n      }\n\n      // Bewacher-ID\n      if (jobTags.includes(SECURITY_BEWACHER_ID) && !workerSkills.includes(SECURITY_BEWACHER_ID)) {\n        missingSecuritySkill = \"Bewacher-ID\";\n      }\n\n      // Polizeiliches Führungszeugnis\n      if (jobTags.includes(SECURITY_FUEHRUNGSZEUGNIS) && !workerSkills.includes(SECURITY_FUEHRUNGSZEUGNIS)) {\n        missingSecuritySkill = \"Polizeiliches Führungszeugnis\";\n      }\n\n      // Determine disabled state and reason\n      const disabled = distance > worker.radiusKm || !!missingSecuritySkill;\n      let disabledReason;\n      if (distance > worker.radiusKm) {\n        disabledReason = \"Außerhalb deines Radius\";\n      } else if (missingSecuritySkill) {\n        disabledReason = `Erfordert ${missingSecuritySkill}`;\n      }\n\n      // Normalize address\n      const normalizedAddress = (0, _address.formatAddress)(job.address, true) || (0, _normalizeAddress.normalizeAddress)(job.address?.city || \"\");\n      return {\n        ...job,\n        distance,\n        normalizedAddress,\n        disabled,\n        disabledReason\n      };\n    }).sort((a, b) => a.distance - b.distance); // Sort by distance (closest first)\n  }\n});","lineCount":80,"map":[[6,2,4,0],[6,6,4,0,"_distance"],[6,15,4,0],[6,18,4,0,"require"],[6,25,4,0],[6,26,4,0,"_dependencyMap"],[6,40,4,0],[7,2,5,0],[7,6,5,0,"_normalizeAddress"],[7,23,5,0],[7,26,5,0,"require"],[7,33,5,0],[7,34,5,0,"_dependencyMap"],[7,48,5,0],[8,2,6,0],[8,6,6,0,"_address"],[8,14,6,0],[8,17,6,0,"require"],[8,24,6,0],[8,25,6,0,"_dependencyMap"],[8,39,6,0],[9,2,1,0],[11,2,9,0],[12,2,10,0],[12,8,10,6,"SECURITY_SACHKUNDE"],[12,26,10,24],[12,29,10,27],[12,56,10,54],[13,2,11,0],[13,8,11,6,"SECURITY_UNTERRICHTUNG"],[13,30,11,28],[13,33,11,31],[13,64,11,62],[14,2,12,0],[14,8,12,6,"SECURITY_BEWACHER_ID"],[14,28,12,26],[14,31,12,29],[14,44,12,42],[15,2,13,0],[15,8,13,6,"SECURITY_FUEHRUNGSZEUGNIS"],[15,33,13,31],[15,36,13,34],[15,67,13,65],[16,2,22,0],[17,0,23,0],[18,0,24,0],[19,0,25,0],[20,2,26,7],[20,11,26,16,"nearbyJobs"],[20,21,26,26,"nearbyJobs"],[20,22,27,2,"jobs"],[20,26,27,13],[20,28,28,2,"worker"],[20,34,28,23],[20,36,29,15],[21,4,30,2],[21,10,30,8,"workerSkills"],[21,22,30,20],[21,25,30,23,"worker"],[21,31,30,29],[21,32,30,30,"selectedTags"],[21,44,30,42],[21,48,30,46],[21,50,30,48],[22,4,32,2],[22,11,32,9,"jobs"],[22,15,32,13],[22,16,33,5,"map"],[22,19,33,8],[22,20,33,9,"job"],[22,23,33,12],[22,27,33,16],[23,6,34,6],[24,6,35,6],[24,12,35,12,"distance"],[24,20,35,20],[24,23,35,23],[24,27,35,23,"calculateDistance"],[24,54,35,40],[24,56,36,8],[25,8,36,10,"lat"],[25,11,36,13],[25,13,36,15,"job"],[25,16,36,18],[25,17,36,19,"lat"],[25,20,36,22],[26,8,36,24,"lon"],[26,11,36,27],[26,13,36,29,"job"],[26,16,36,32],[26,17,36,33,"lon"],[27,6,36,37],[27,7,36,38],[27,9,37,8],[28,8,37,10,"lat"],[28,11,37,13],[28,13,37,15,"worker"],[28,19,37,21],[28,20,37,22,"homeLat"],[28,27,37,29],[29,8,37,31,"lon"],[29,11,37,34],[29,13,37,36,"worker"],[29,19,37,42],[29,20,37,43,"homeLon"],[30,6,37,51],[30,7,38,6],[30,8,38,7],[32,6,40,6],[33,6,41,6],[33,12,41,12,"jobTags"],[33,19,41,19],[33,22,41,22,"job"],[33,25,41,25],[33,26,41,26,"required_all_tags"],[33,43,41,43],[33,47,41,47],[33,49,41,49],[34,6,43,6],[34,10,43,10,"missingSecuritySkill"],[34,30,43,50],[36,6,45,6],[37,6,46,6],[37,10,46,10,"jobTags"],[37,17,46,17],[37,18,46,18,"includes"],[37,26,46,26],[37,27,46,27,"SECURITY_SACHKUNDE"],[37,45,46,45],[37,46,46,46],[37,50,46,50],[37,51,46,51,"workerSkills"],[37,63,46,63],[37,64,46,64,"includes"],[37,72,46,72],[37,73,46,73,"SECURITY_SACHKUNDE"],[37,91,46,91],[37,92,46,92],[37,94,46,94],[38,8,47,8,"missingSecuritySkill"],[38,28,47,28],[38,31,47,31],[38,48,47,48],[39,6,48,6],[41,6,50,6],[42,6,51,6],[42,10,51,10,"jobTags"],[42,17,51,17],[42,18,51,18,"includes"],[42,26,51,26],[42,27,51,27,"SECURITY_UNTERRICHTUNG"],[42,49,51,49],[42,50,51,50],[42,52,51,52],[43,8,52,8],[43,14,52,14,"hasUnterrichtung"],[43,30,52,30],[43,33,52,33,"workerSkills"],[43,45,52,45],[43,46,52,46,"includes"],[43,54,52,54],[43,55,52,55,"SECURITY_UNTERRICHTUNG"],[43,77,52,77],[43,78,52,78],[44,8,53,8],[44,14,53,14,"hasSachkunde"],[44,26,53,26],[44,29,53,29,"workerSkills"],[44,41,53,41],[44,42,53,42,"includes"],[44,50,53,50],[44,51,53,51,"SECURITY_SACHKUNDE"],[44,69,53,69],[44,70,53,70],[45,8,54,8],[45,12,54,12],[45,13,54,13,"hasUnterrichtung"],[45,29,54,29],[45,33,54,33],[45,34,54,34,"hasSachkunde"],[45,46,54,46],[45,48,54,48],[46,10,55,10,"missingSecuritySkill"],[46,30,55,30],[46,33,55,33],[46,54,55,54],[47,8,56,8],[48,6,57,6],[50,6,59,6],[51,6,60,6],[51,10,60,10,"jobTags"],[51,17,60,17],[51,18,60,18,"includes"],[51,26,60,26],[51,27,60,27,"SECURITY_BEWACHER_ID"],[51,47,60,47],[51,48,60,48],[51,52,60,52],[51,53,60,53,"workerSkills"],[51,65,60,65],[51,66,60,66,"includes"],[51,74,60,74],[51,75,60,75,"SECURITY_BEWACHER_ID"],[51,95,60,95],[51,96,60,96],[51,98,60,98],[52,8,61,8,"missingSecuritySkill"],[52,28,61,28],[52,31,61,31],[52,44,61,44],[53,6,62,6],[55,6,64,6],[56,6,65,6],[56,10,65,10,"jobTags"],[56,17,65,17],[56,18,65,18,"includes"],[56,26,65,26],[56,27,65,27,"SECURITY_FUEHRUNGSZEUGNIS"],[56,52,65,52],[56,53,65,53],[56,57,65,57],[56,58,65,58,"workerSkills"],[56,70,65,70],[56,71,65,71,"includes"],[56,79,65,79],[56,80,65,80,"SECURITY_FUEHRUNGSZEUGNIS"],[56,105,65,105],[56,106,65,106],[56,108,65,108],[57,8,66,8,"missingSecuritySkill"],[57,28,66,28],[57,31,66,31],[57,62,66,62],[58,6,67,6],[60,6,69,6],[61,6,70,6],[61,12,70,12,"disabled"],[61,20,70,20],[61,23,70,23,"distance"],[61,31,70,31],[61,34,70,34,"worker"],[61,40,70,40],[61,41,70,41,"radiusKm"],[61,49,70,49],[61,53,70,53],[61,54,70,54],[61,55,70,55,"missingSecuritySkill"],[61,75,70,75],[62,6,72,6],[62,10,72,10,"disabledReason"],[62,24,72,44],[63,6,73,6],[63,10,73,10,"distance"],[63,18,73,18],[63,21,73,21,"worker"],[63,27,73,27],[63,28,73,28,"radiusKm"],[63,36,73,36],[63,38,73,38],[64,8,74,8,"disabledReason"],[64,22,74,22],[64,25,74,25],[64,50,74,50],[65,6,75,6],[65,7,75,7],[65,13,75,13],[65,17,75,17,"missingSecuritySkill"],[65,37,75,37],[65,39,75,39],[66,8,76,8,"disabledReason"],[66,22,76,22],[66,25,76,25],[66,38,76,38,"missingSecuritySkill"],[66,58,76,58],[66,60,76,60],[67,6,77,6],[69,6,79,6],[70,6,80,6],[70,12,80,12,"normalizedAddress"],[70,29,80,29],[70,32,80,32],[70,36,80,32,"formatAddress"],[70,58,80,45],[70,60,80,46,"job"],[70,63,80,49],[70,64,80,50,"address"],[70,71,80,57],[70,73,80,59],[70,77,80,63],[70,78,80,64],[70,82,81,32],[70,86,81,32,"normalizeAddress"],[70,120,81,48],[70,122,81,49,"job"],[70,125,81,52],[70,126,81,53,"address"],[70,133,81,60],[70,135,81,62,"city"],[70,139,81,66],[70,143,81,70],[70,145,81,72],[70,146,81,73],[71,6,83,6],[71,13,83,13],[72,8,84,8],[72,11,84,11,"job"],[72,14,84,14],[73,8,85,8,"distance"],[73,16,85,16],[74,8,86,8,"normalizedAddress"],[74,25,86,25],[75,8,87,8,"disabled"],[75,16,87,16],[76,8,88,8,"disabledReason"],[77,6,89,6],[77,7,89,7],[78,4,90,4],[78,5,90,5],[78,6,90,6],[78,7,91,5,"sort"],[78,11,91,9],[78,12,91,10],[78,13,91,11,"a"],[78,14,91,12],[78,16,91,14,"b"],[78,17,91,15],[78,22,91,20,"a"],[78,23,91,21],[78,24,91,22,"distance"],[78,32,91,30],[78,35,91,33,"b"],[78,36,91,34],[78,37,91,35,"distance"],[78,45,91,43],[78,46,91,44],[78,47,91,45],[78,48,91,46],[79,2,92,0],[80,0,92,1]],"functionMap":{"names":["<global>","nearbyJobs","jobs.map$argument_0","jobs.map.sort$argument_0"],"mappings":"AAA;OCyB;SCO;KDyD;UEC,iCF;CDC"}},"type":"js/module"}]}
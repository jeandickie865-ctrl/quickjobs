{"dependencies":[{"name":"../config","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":36},"end":{"line":3,"column":36,"index":72}}],"key":"pHqFJJBAh3HI9ZCkK8fFRwPv3x0=","exportNames":["*"],"imports":1}},{"name":"./api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":73},"end":{"line":4,"column":39,"index":112}}],"key":"FbKPDeRJ9TF3vg1eKYKz12urgic=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.loadMessages = loadMessages;\n  exports.sendMessage = sendMessage;\n  exports.checkChatUnlocked = checkChatUnlocked;\n  var _config = require(_dependencyMap[0], \"../config\");\n  var _api = require(_dependencyMap[1], \"./api\");\n  // app/frontend/utils/chatStore.ts\n\n  /**\n   * Lädt alle Nachrichten für eine Application.\n   * Chat ist nur freigeschaltet, wenn application.chatUnlocked = true.\n   */\n  async function loadMessages(applicationId) {\n    const headers = await (0, _api.getAuthHeaders)();\n    const res = await fetch(`${_config.API_URL}/chat/messages/${applicationId}`, {\n      method: \"GET\",\n      headers\n    });\n    if (res.status === 402) {\n      throw new Error(\"CHAT_LOCKED\"); // Chat noch nicht bezahlt\n    }\n    if (!res.ok) {\n      throw new Error(\"FAILED_TO_LOAD_MESSAGES\");\n    }\n    const raw = await res.json();\n\n    // Normalisiere die Daten: Stelle sicher, dass immer ein \"text\" Feld existiert\n    return raw.map(m => ({\n      id: m.id || m._id,\n      applicationId: m.applicationId || m.application_id,\n      senderId: m.senderId || m.sender_id || m.fromId,\n      senderRole: m.senderRole || m.sender_role,\n      text: m.text || m.message || m.body || m.content || m.textBody || '',\n      createdAt: m.createdAt || m.created_at || m.timestamp,\n      timestamp: m.timestamp || m.createdAt || m.created_at,\n      read: m.read !== undefined ? m.read : false\n    }));\n  }\n\n  /**\n   * Sendet Nachricht.\n   */\n  async function sendMessage(applicationId, text) {\n    const headers = await (0, _api.getAuthHeaders)();\n    const res = await fetch(`${_config.API_URL}/chat/messages`, {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify({\n        applicationId,\n        text\n      })\n    });\n    if (res.status === 402) {\n      throw new Error(\"CHAT_LOCKED\");\n    }\n    if (res.status === 422) {\n      throw new Error(\"EMPTY_MESSAGE\");\n    }\n    if (!res.ok) {\n      throw new Error(\"FAILED_TO_SEND_MESSAGE\");\n    }\n    return await res.json();\n  }\n\n  /**\n   * Initialer Check ob Chat freigeschaltet ist.\n   */\n  async function checkChatUnlocked(applicationId) {\n    const headers = await (0, _api.getAuthHeaders)();\n    const res = await fetch(`${_config.API_URL}/applications/${applicationId}`, {\n      method: \"GET\",\n      headers\n    });\n    if (!res.ok) return false;\n    const data = await res.json();\n    return data.chatUnlocked === true;\n  }\n});","lineCount":83,"map":[[7,2,11,0,"exports"],[7,9,11,0],[7,10,11,0,"loadMessages"],[7,22,11,0],[7,25,11,0,"loadMessages"],[7,37,11,0],[8,2,45,0,"exports"],[8,9,45,0],[8,10,45,0,"sendMessage"],[8,21,45,0],[8,24,45,0,"sendMessage"],[8,35,45,0],[9,2,75,0,"exports"],[9,9,75,0],[9,10,75,0,"checkChatUnlocked"],[9,27,75,0],[9,30,75,0,"checkChatUnlocked"],[9,47,75,0],[10,2,3,0],[10,6,3,0,"_config"],[10,13,3,0],[10,16,3,0,"require"],[10,23,3,0],[10,24,3,0,"_dependencyMap"],[10,38,3,0],[11,2,4,0],[11,6,4,0,"_api"],[11,10,4,0],[11,13,4,0,"require"],[11,20,4,0],[11,21,4,0,"_dependencyMap"],[11,35,4,0],[12,2,1,0],[14,2,7,0],[15,0,8,0],[16,0,9,0],[17,0,10,0],[18,2,11,7],[18,17,11,22,"loadMessages"],[18,29,11,34,"loadMessages"],[18,30,11,35,"applicationId"],[18,43,11,56],[18,45,11,82],[19,4,12,2],[19,10,12,8,"headers"],[19,17,12,15],[19,20,12,18],[19,26,12,24],[19,30,12,24,"getAuthHeaders"],[19,34,12,38],[19,35,12,38,"getAuthHeaders"],[19,49,12,38],[19,51,12,39],[19,52,12,40],[20,4,14,2],[20,10,14,8,"res"],[20,13,14,11],[20,16,14,14],[20,22,14,20,"fetch"],[20,27,14,25],[20,28,14,26],[20,31,14,29,"API_URL"],[20,38,14,36],[20,39,14,36,"API_URL"],[20,46,14,36],[20,64,14,54,"applicationId"],[20,77,14,67],[20,79,14,69],[20,81,14,71],[21,6,15,4,"method"],[21,12,15,10],[21,14,15,12],[21,19,15,17],[22,6,16,4,"headers"],[23,4,17,2],[23,5,17,3],[23,6,17,4],[24,4,19,2],[24,8,19,6,"res"],[24,11,19,9],[24,12,19,10,"status"],[24,18,19,16],[24,23,19,21],[24,26,19,24],[24,28,19,26],[25,6,20,4],[25,12,20,10],[25,16,20,14,"Error"],[25,21,20,19],[25,22,20,20],[25,35,20,33],[25,36,20,34],[25,37,20,35],[25,38,20,36],[26,4,21,2],[27,4,23,2],[27,8,23,6],[27,9,23,7,"res"],[27,12,23,10],[27,13,23,11,"ok"],[27,15,23,13],[27,17,23,15],[28,6,24,4],[28,12,24,10],[28,16,24,14,"Error"],[28,21,24,19],[28,22,24,20],[28,47,24,45],[28,48,24,46],[29,4,25,2],[30,4,27,2],[30,10,27,8,"raw"],[30,13,27,11],[30,16,27,14],[30,22,27,20,"res"],[30,25,27,23],[30,26,27,24,"json"],[30,30,27,28],[30,31,27,29],[30,32,27,30],[32,4,29,2],[33,4,30,2],[33,11,30,9,"raw"],[33,14,30,12],[33,15,30,13,"map"],[33,18,30,16],[33,19,30,18,"m"],[33,20,30,24],[33,25,30,30],[34,6,31,4,"id"],[34,8,31,6],[34,10,31,8,"m"],[34,11,31,9],[34,12,31,10,"id"],[34,14,31,12],[34,18,31,16,"m"],[34,19,31,17],[34,20,31,18,"_id"],[34,23,31,21],[35,6,32,4,"applicationId"],[35,19,32,17],[35,21,32,19,"m"],[35,22,32,20],[35,23,32,21,"applicationId"],[35,36,32,34],[35,40,32,38,"m"],[35,41,32,39],[35,42,32,40,"application_id"],[35,56,32,54],[36,6,33,4,"senderId"],[36,14,33,12],[36,16,33,14,"m"],[36,17,33,15],[36,18,33,16,"senderId"],[36,26,33,24],[36,30,33,28,"m"],[36,31,33,29],[36,32,33,30,"sender_id"],[36,41,33,39],[36,45,33,43,"m"],[36,46,33,44],[36,47,33,45,"fromId"],[36,53,33,51],[37,6,34,4,"senderRole"],[37,16,34,14],[37,18,34,16,"m"],[37,19,34,17],[37,20,34,18,"senderRole"],[37,30,34,28],[37,34,34,32,"m"],[37,35,34,33],[37,36,34,34,"sender_role"],[37,47,34,45],[38,6,35,4,"text"],[38,10,35,8],[38,12,35,10,"m"],[38,13,35,11],[38,14,35,12,"text"],[38,18,35,16],[38,22,35,20,"m"],[38,23,35,21],[38,24,35,22,"message"],[38,31,35,29],[38,35,35,33,"m"],[38,36,35,34],[38,37,35,35,"body"],[38,41,35,39],[38,45,35,43,"m"],[38,46,35,44],[38,47,35,45,"content"],[38,54,35,52],[38,58,35,56,"m"],[38,59,35,57],[38,60,35,58,"textBody"],[38,68,35,66],[38,72,35,70],[38,74,35,72],[39,6,36,4,"createdAt"],[39,15,36,13],[39,17,36,15,"m"],[39,18,36,16],[39,19,36,17,"createdAt"],[39,28,36,26],[39,32,36,30,"m"],[39,33,36,31],[39,34,36,32,"created_at"],[39,44,36,42],[39,48,36,46,"m"],[39,49,36,47],[39,50,36,48,"timestamp"],[39,59,36,57],[40,6,37,4,"timestamp"],[40,15,37,13],[40,17,37,15,"m"],[40,18,37,16],[40,19,37,17,"timestamp"],[40,28,37,26],[40,32,37,30,"m"],[40,33,37,31],[40,34,37,32,"createdAt"],[40,43,37,41],[40,47,37,45,"m"],[40,48,37,46],[40,49,37,47,"created_at"],[40,59,37,57],[41,6,38,4,"read"],[41,10,38,8],[41,12,38,10,"m"],[41,13,38,11],[41,14,38,12,"read"],[41,18,38,16],[41,23,38,21,"undefined"],[41,32,38,30],[41,35,38,33,"m"],[41,36,38,34],[41,37,38,35,"read"],[41,41,38,39],[41,44,38,42],[42,4,39,2],[42,5,39,3],[42,6,39,4],[42,7,39,5],[43,2,40,0],[45,2,42,0],[46,0,43,0],[47,0,44,0],[48,2,45,7],[48,17,45,22,"sendMessage"],[48,28,45,33,"sendMessage"],[48,29,46,2,"applicationId"],[48,42,46,23],[48,44,47,2,"text"],[48,48,47,14],[48,50,48,24],[49,4,49,2],[49,10,49,8,"headers"],[49,17,49,15],[49,20,49,18],[49,26,49,24],[49,30,49,24,"getAuthHeaders"],[49,34,49,38],[49,35,49,38,"getAuthHeaders"],[49,49,49,38],[49,51,49,39],[49,52,49,40],[50,4,51,2],[50,10,51,8,"res"],[50,13,51,11],[50,16,51,14],[50,22,51,20,"fetch"],[50,27,51,25],[50,28,51,26],[50,31,51,29,"API_URL"],[50,38,51,36],[50,39,51,36,"API_URL"],[50,46,51,36],[50,62,51,52],[50,64,51,54],[51,6,52,4,"method"],[51,12,52,10],[51,14,52,12],[51,20,52,18],[52,6,53,4,"headers"],[52,13,53,11],[53,6,54,4,"body"],[53,10,54,8],[53,12,54,10,"JSON"],[53,16,54,14],[53,17,54,15,"stringify"],[53,26,54,24],[53,27,54,25],[54,8,54,27,"applicationId"],[54,21,54,40],[55,8,54,42,"text"],[56,6,54,47],[56,7,54,48],[57,4,55,2],[57,5,55,3],[57,6,55,4],[58,4,57,2],[58,8,57,6,"res"],[58,11,57,9],[58,12,57,10,"status"],[58,18,57,16],[58,23,57,21],[58,26,57,24],[58,28,57,26],[59,6,58,4],[59,12,58,10],[59,16,58,14,"Error"],[59,21,58,19],[59,22,58,20],[59,35,58,33],[59,36,58,34],[60,4,59,2],[61,4,61,2],[61,8,61,6,"res"],[61,11,61,9],[61,12,61,10,"status"],[61,18,61,16],[61,23,61,21],[61,26,61,24],[61,28,61,26],[62,6,62,4],[62,12,62,10],[62,16,62,14,"Error"],[62,21,62,19],[62,22,62,20],[62,37,62,35],[62,38,62,36],[63,4,63,2],[64,4,65,2],[64,8,65,6],[64,9,65,7,"res"],[64,12,65,10],[64,13,65,11,"ok"],[64,15,65,13],[64,17,65,15],[65,6,66,4],[65,12,66,10],[65,16,66,14,"Error"],[65,21,66,19],[65,22,66,20],[65,46,66,44],[65,47,66,45],[66,4,67,2],[67,4,69,2],[67,11,69,9],[67,17,69,15,"res"],[67,20,69,18],[67,21,69,19,"json"],[67,25,69,23],[67,26,69,24],[67,27,69,25],[68,2,70,0],[70,2,72,0],[71,0,73,0],[72,0,74,0],[73,2,75,7],[73,17,75,22,"checkChatUnlocked"],[73,34,75,39,"checkChatUnlocked"],[73,35,75,40,"applicationId"],[73,48,75,61],[73,50,75,81],[74,4,76,2],[74,10,76,8,"headers"],[74,17,76,15],[74,20,76,18],[74,26,76,24],[74,30,76,24,"getAuthHeaders"],[74,34,76,38],[74,35,76,38,"getAuthHeaders"],[74,49,76,38],[74,51,76,39],[74,52,76,40],[75,4,77,2],[75,10,77,8,"res"],[75,13,77,11],[75,16,77,14],[75,22,77,20,"fetch"],[75,27,77,25],[75,28,77,26],[75,31,77,29,"API_URL"],[75,38,77,36],[75,39,77,36,"API_URL"],[75,46,77,36],[75,63,77,53,"applicationId"],[75,76,77,66],[75,78,77,68],[75,80,77,70],[76,6,78,4,"method"],[76,12,78,10],[76,14,78,12],[76,19,78,17],[77,6,79,4,"headers"],[78,4,80,2],[78,5,80,3],[78,6,80,4],[79,4,82,2],[79,8,82,6],[79,9,82,7,"res"],[79,12,82,10],[79,13,82,11,"ok"],[79,15,82,13],[79,17,82,15],[79,24,82,22],[79,29,82,27],[80,4,84,2],[80,10,84,8,"data"],[80,14,84,12],[80,17,84,15],[80,23,84,21,"res"],[80,26,84,24],[80,27,84,25,"json"],[80,31,84,29],[80,32,84,30],[80,33,84,31],[81,4,85,2],[81,11,85,9,"data"],[81,15,85,13],[81,16,85,14,"chatUnlocked"],[81,28,85,26],[81,33,85,31],[81,37,85,35],[82,2,86,0],[83,0,86,1],[83,3]],"functionMap":{"names":["<global>","loadMessages","raw.map$argument_0","sendMessage","checkChatUnlocked"],"mappings":"AAA;OCU;iBCmB;IDS;CDC;OGK;CHyB;OIK;CJW"},"hasCjsExports":false},"type":"js/module"}]}
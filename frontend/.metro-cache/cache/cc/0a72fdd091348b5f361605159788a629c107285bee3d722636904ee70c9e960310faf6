{"dependencies":[{"name":"./distance","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":151},"end":{"line":4,"column":47,"index":198}}],"key":"iycZ8wRItk4OOQEBVmvrrq3ooL8=","exportNames":["*"],"imports":1}},{"name":"./normalizeAddress","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":199},"end":{"line":5,"column":54,"index":253}}],"key":"m3UysYDWsYidjBqN8dpi7aXnojU=","exportNames":["*"],"imports":1}},{"name":"../types/address","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":254},"end":{"line":6,"column":49,"index":303}}],"key":"RVJOe6JSBSaA+pZyb/fapuHyuxI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.nearbyJobs = nearbyJobs;\n  var _distance = require(_dependencyMap[0], \"./distance\");\n  var _normalizeAddress = require(_dependencyMap[1], \"./normalizeAddress\");\n  var _typesAddress = require(_dependencyMap[2], \"../types/address\");\n  // utils/nearbyJobs.ts - MATCHING 2.2 (Extended Security Checks)\n\n  // Security Tags (alle werden geprüft)\n  var SECURITY_SACHKUNDE = \"Sachkunde nach § 34a GewO\";\n  var SECURITY_UNTERRICHTUNG = \"Unterrichtung nach § 34a GewO\";\n  var SECURITY_BEWACHER_ID = \"Bewacher-ID\";\n  var SECURITY_FUEHRUNGSZEUGNIS = \"Polizeiliches Führungszeugnis\";\n  /**\n   * Get jobs near the worker with distance info and disabled state\n   * MATCHING 2.0 - Simple nearby jobs view\n   */\n  function nearbyJobs(jobs, worker) {\n    var workerSkills = worker.selectedTags || [];\n    return jobs.map(job => {\n      // Calculate distance\n      var distance = (0, _distance.calculateDistance)({\n        lat: job.lat,\n        lon: job.lon\n      }, {\n        lat: worker.homeLat,\n        lon: worker.homeLon\n      });\n\n      // Check all security requirements (MATCHING 2.2)\n      var jobTags = job.required_all_tags || [];\n      var missingSecuritySkill;\n\n      // Sachkunde §34a\n      if (jobTags.includes(SECURITY_SACHKUNDE) && !workerSkills.includes(SECURITY_SACHKUNDE)) {\n        missingSecuritySkill = \"Sachkunde § 34a\";\n      }\n\n      // Unterrichtung §34a (oder Sachkunde)\n      if (jobTags.includes(SECURITY_UNTERRICHTUNG)) {\n        var hasUnterrichtung = workerSkills.includes(SECURITY_UNTERRICHTUNG);\n        var hasSachkunde = workerSkills.includes(SECURITY_SACHKUNDE);\n        if (!hasUnterrichtung && !hasSachkunde) {\n          missingSecuritySkill = \"Unterrichtung § 34a\";\n        }\n      }\n\n      // Bewacher-ID\n      if (jobTags.includes(SECURITY_BEWACHER_ID) && !workerSkills.includes(SECURITY_BEWACHER_ID)) {\n        missingSecuritySkill = \"Bewacher-ID\";\n      }\n\n      // Polizeiliches Führungszeugnis\n      if (jobTags.includes(SECURITY_FUEHRUNGSZEUGNIS) && !workerSkills.includes(SECURITY_FUEHRUNGSZEUGNIS)) {\n        missingSecuritySkill = \"Polizeiliches Führungszeugnis\";\n      }\n\n      // Determine disabled state and reason\n      var disabled = distance > worker.radiusKm || !!missingSecuritySkill;\n      var disabledReason;\n      if (distance > worker.radiusKm) {\n        disabledReason = \"Außerhalb deines Radius\";\n      } else if (missingSecuritySkill) {\n        disabledReason = `Erfordert ${missingSecuritySkill}`;\n      }\n\n      // Normalize address\n      var normalizedAddress = (0, _typesAddress.formatAddress)(job.address, true) || (0, _normalizeAddress.normalizeAddress)(job.address?.city || \"\");\n      return {\n        ...job,\n        distance,\n        normalizedAddress,\n        disabled,\n        disabledReason\n      };\n    }).sort((a, b) => a.distance - b.distance); // Sort by distance (closest first)\n  }\n});","lineCount":82,"map":[[7,2,26,0,"exports"],[7,9,26,0],[7,10,26,0,"nearbyJobs"],[7,20,26,0],[7,23,26,0,"nearbyJobs"],[7,33,26,0],[8,2,4,0],[8,6,4,0,"_distance"],[8,15,4,0],[8,18,4,0,"require"],[8,25,4,0],[8,26,4,0,"_dependencyMap"],[8,40,4,0],[9,2,5,0],[9,6,5,0,"_normalizeAddress"],[9,23,5,0],[9,26,5,0,"require"],[9,33,5,0],[9,34,5,0,"_dependencyMap"],[9,48,5,0],[10,2,6,0],[10,6,6,0,"_typesAddress"],[10,19,6,0],[10,22,6,0,"require"],[10,29,6,0],[10,30,6,0,"_dependencyMap"],[10,44,6,0],[11,2,1,0],[13,2,9,0],[14,2,10,0],[14,6,10,6,"SECURITY_SACHKUNDE"],[14,24,10,24],[14,27,10,27],[14,54,10,54],[15,2,11,0],[15,6,11,6,"SECURITY_UNTERRICHTUNG"],[15,28,11,28],[15,31,11,31],[15,62,11,62],[16,2,12,0],[16,6,12,6,"SECURITY_BEWACHER_ID"],[16,26,12,26],[16,29,12,29],[16,42,12,42],[17,2,13,0],[17,6,13,6,"SECURITY_FUEHRUNGSZEUGNIS"],[17,31,13,31],[17,34,13,34],[17,65,13,65],[18,2,22,0],[19,0,23,0],[20,0,24,0],[21,0,25,0],[22,2,26,7],[22,11,26,16,"nearbyJobs"],[22,21,26,26,"nearbyJobs"],[22,22,27,2,"jobs"],[22,26,27,13],[22,28,28,2,"worker"],[22,34,28,23],[22,36,29,15],[23,4,30,2],[23,8,30,8,"workerSkills"],[23,20,30,20],[23,23,30,23,"worker"],[23,29,30,29],[23,30,30,30,"selectedTags"],[23,42,30,42],[23,46,30,46],[23,48,30,48],[24,4,32,2],[24,11,32,9,"jobs"],[24,15,32,13],[24,16,33,5,"map"],[24,19,33,8],[24,20,33,9,"job"],[24,23,33,12],[24,27,33,16],[25,6,34,6],[26,6,35,6],[26,10,35,12,"distance"],[26,18,35,20],[26,21,35,23],[26,25,35,23,"calculateDistance"],[26,34,35,40],[26,35,35,40,"calculateDistance"],[26,52,35,40],[26,54,36,8],[27,8,36,10,"lat"],[27,11,36,13],[27,13,36,15,"job"],[27,16,36,18],[27,17,36,19,"lat"],[27,20,36,22],[28,8,36,24,"lon"],[28,11,36,27],[28,13,36,29,"job"],[28,16,36,32],[28,17,36,33,"lon"],[29,6,36,37],[29,7,36,38],[29,9,37,8],[30,8,37,10,"lat"],[30,11,37,13],[30,13,37,15,"worker"],[30,19,37,21],[30,20,37,22,"homeLat"],[30,27,37,29],[31,8,37,31,"lon"],[31,11,37,34],[31,13,37,36,"worker"],[31,19,37,42],[31,20,37,43,"homeLon"],[32,6,37,51],[32,7,38,6],[32,8,38,7],[34,6,40,6],[35,6,41,6],[35,10,41,12,"jobTags"],[35,17,41,19],[35,20,41,22,"job"],[35,23,41,25],[35,24,41,26,"required_all_tags"],[35,41,41,43],[35,45,41,47],[35,47,41,49],[36,6,43,6],[36,10,43,10,"missingSecuritySkill"],[36,30,43,50],[38,6,45,6],[39,6,46,6],[39,10,46,10,"jobTags"],[39,17,46,17],[39,18,46,18,"includes"],[39,26,46,26],[39,27,46,27,"SECURITY_SACHKUNDE"],[39,45,46,45],[39,46,46,46],[39,50,46,50],[39,51,46,51,"workerSkills"],[39,63,46,63],[39,64,46,64,"includes"],[39,72,46,72],[39,73,46,73,"SECURITY_SACHKUNDE"],[39,91,46,91],[39,92,46,92],[39,94,46,94],[40,8,47,8,"missingSecuritySkill"],[40,28,47,28],[40,31,47,31],[40,48,47,48],[41,6,48,6],[43,6,50,6],[44,6,51,6],[44,10,51,10,"jobTags"],[44,17,51,17],[44,18,51,18,"includes"],[44,26,51,26],[44,27,51,27,"SECURITY_UNTERRICHTUNG"],[44,49,51,49],[44,50,51,50],[44,52,51,52],[45,8,52,8],[45,12,52,14,"hasUnterrichtung"],[45,28,52,30],[45,31,52,33,"workerSkills"],[45,43,52,45],[45,44,52,46,"includes"],[45,52,52,54],[45,53,52,55,"SECURITY_UNTERRICHTUNG"],[45,75,52,77],[45,76,52,78],[46,8,53,8],[46,12,53,14,"hasSachkunde"],[46,24,53,26],[46,27,53,29,"workerSkills"],[46,39,53,41],[46,40,53,42,"includes"],[46,48,53,50],[46,49,53,51,"SECURITY_SACHKUNDE"],[46,67,53,69],[46,68,53,70],[47,8,54,8],[47,12,54,12],[47,13,54,13,"hasUnterrichtung"],[47,29,54,29],[47,33,54,33],[47,34,54,34,"hasSachkunde"],[47,46,54,46],[47,48,54,48],[48,10,55,10,"missingSecuritySkill"],[48,30,55,30],[48,33,55,33],[48,54,55,54],[49,8,56,8],[50,6,57,6],[52,6,59,6],[53,6,60,6],[53,10,60,10,"jobTags"],[53,17,60,17],[53,18,60,18,"includes"],[53,26,60,26],[53,27,60,27,"SECURITY_BEWACHER_ID"],[53,47,60,47],[53,48,60,48],[53,52,60,52],[53,53,60,53,"workerSkills"],[53,65,60,65],[53,66,60,66,"includes"],[53,74,60,74],[53,75,60,75,"SECURITY_BEWACHER_ID"],[53,95,60,95],[53,96,60,96],[53,98,60,98],[54,8,61,8,"missingSecuritySkill"],[54,28,61,28],[54,31,61,31],[54,44,61,44],[55,6,62,6],[57,6,64,6],[58,6,65,6],[58,10,65,10,"jobTags"],[58,17,65,17],[58,18,65,18,"includes"],[58,26,65,26],[58,27,65,27,"SECURITY_FUEHRUNGSZEUGNIS"],[58,52,65,52],[58,53,65,53],[58,57,65,57],[58,58,65,58,"workerSkills"],[58,70,65,70],[58,71,65,71,"includes"],[58,79,65,79],[58,80,65,80,"SECURITY_FUEHRUNGSZEUGNIS"],[58,105,65,105],[58,106,65,106],[58,108,65,108],[59,8,66,8,"missingSecuritySkill"],[59,28,66,28],[59,31,66,31],[59,62,66,62],[60,6,67,6],[62,6,69,6],[63,6,70,6],[63,10,70,12,"disabled"],[63,18,70,20],[63,21,70,23,"distance"],[63,29,70,31],[63,32,70,34,"worker"],[63,38,70,40],[63,39,70,41,"radiusKm"],[63,47,70,49],[63,51,70,53],[63,52,70,54],[63,53,70,55,"missingSecuritySkill"],[63,73,70,75],[64,6,72,6],[64,10,72,10,"disabledReason"],[64,24,72,44],[65,6,73,6],[65,10,73,10,"distance"],[65,18,73,18],[65,21,73,21,"worker"],[65,27,73,27],[65,28,73,28,"radiusKm"],[65,36,73,36],[65,38,73,38],[66,8,74,8,"disabledReason"],[66,22,74,22],[66,25,74,25],[66,50,74,50],[67,6,75,6],[67,7,75,7],[67,13,75,13],[67,17,75,17,"missingSecuritySkill"],[67,37,75,37],[67,39,75,39],[68,8,76,8,"disabledReason"],[68,22,76,22],[68,25,76,25],[68,38,76,38,"missingSecuritySkill"],[68,58,76,58],[68,60,76,60],[69,6,77,6],[71,6,79,6],[72,6,80,6],[72,10,80,12,"normalizedAddress"],[72,27,80,29],[72,30,80,32],[72,34,80,32,"formatAddress"],[72,47,80,45],[72,48,80,45,"formatAddress"],[72,61,80,45],[72,63,80,46,"job"],[72,66,80,49],[72,67,80,50,"address"],[72,74,80,57],[72,76,80,59],[72,80,80,63],[72,81,80,64],[72,85,81,32],[72,89,81,32,"normalizeAddress"],[72,106,81,48],[72,107,81,48,"normalizeAddress"],[72,123,81,48],[72,125,81,49,"job"],[72,128,81,52],[72,129,81,53,"address"],[72,136,81,60],[72,138,81,62,"city"],[72,142,81,66],[72,146,81,70],[72,148,81,72],[72,149,81,73],[73,6,83,6],[73,13,83,13],[74,8,84,8],[74,11,84,11,"job"],[74,14,84,14],[75,8,85,8,"distance"],[75,16,85,16],[76,8,86,8,"normalizedAddress"],[76,25,86,25],[77,8,87,8,"disabled"],[77,16,87,16],[78,8,88,8,"disabledReason"],[79,6,89,6],[79,7,89,7],[80,4,90,4],[80,5,90,5],[80,6,90,6],[80,7,91,5,"sort"],[80,11,91,9],[80,12,91,10],[80,13,91,11,"a"],[80,14,91,12],[80,16,91,14,"b"],[80,17,91,15],[80,22,91,20,"a"],[80,23,91,21],[80,24,91,22,"distance"],[80,32,91,30],[80,35,91,33,"b"],[80,36,91,34],[80,37,91,35,"distance"],[80,45,91,43],[80,46,91,44],[80,47,91,45],[80,48,91,46],[81,2,92,0],[82,0,92,1],[82,3]],"functionMap":{"names":["<global>","nearbyJobs","jobs.map$argument_0","jobs.map.sort$argument_0"],"mappings":"AAA;OCyB;SCO;KDyD;UEC,iCF;CDC"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"../config","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":36},"end":{"line":3,"column":36,"index":72}}],"key":"pHqFJJBAh3HI9ZCkK8fFRwPv3x0=","exportNames":["*"],"imports":1}},{"name":"./api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":73},"end":{"line":4,"column":39,"index":112}}],"key":"FbKPDeRJ9TF3vg1eKYKz12urgic=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.loadMessages = loadMessages;\n  exports.sendMessage = sendMessage;\n  exports.checkChatUnlocked = checkChatUnlocked;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _config = require(_dependencyMap[1], \"../config\");\n  var _api = require(_dependencyMap[2], \"./api\");\n  // app/frontend/utils/chatStore.ts\n  /**\n   * Lädt alle Nachrichten für eine Application.\n   * Chat ist nur freigeschaltet, wenn application.chatUnlocked = true.\n   */\n  function loadMessages(_x) {\n    return _loadMessages.apply(this, arguments);\n  }\n  /**\n   * Sendet Nachricht.\n   */\n  function _loadMessages() {\n    _loadMessages = (0, _asyncToGenerator.default)(function* (applicationId) {\n      var headers = yield (0, _api.getAuthHeaders)();\n      var res = yield fetch(`${_config.API_URL}/chat/messages/${applicationId}`, {\n        method: \"GET\",\n        headers\n      });\n      if (res.status === 402) {\n        throw new Error(\"CHAT_LOCKED\"); // Chat noch nicht bezahlt\n      }\n      if (!res.ok) {\n        throw new Error(\"FAILED_TO_LOAD_MESSAGES\");\n      }\n      var raw = yield res.json();\n\n      // Normalisiere die Daten: Stelle sicher, dass immer ein \"text\" Feld existiert\n      return raw.map(m => ({\n        id: m.id || m._id,\n        applicationId: m.applicationId || m.application_id,\n        senderId: m.senderId || m.sender_id || m.fromId,\n        senderRole: m.senderRole || m.sender_role,\n        text: m.text || m.message || m.body || m.content || m.textBody || '',\n        createdAt: m.createdAt || m.created_at || m.timestamp,\n        timestamp: m.timestamp || m.createdAt || m.created_at,\n        read: m.read !== undefined ? m.read : false\n      }));\n    });\n    return _loadMessages.apply(this, arguments);\n  }\n  function sendMessage(_x2, _x3) {\n    return _sendMessage.apply(this, arguments);\n  }\n  /**\n   * Initialer Check ob Chat freigeschaltet ist.\n   */\n  function _sendMessage() {\n    _sendMessage = (0, _asyncToGenerator.default)(function* (applicationId, text) {\n      var headers = yield (0, _api.getAuthHeaders)();\n      var res = yield fetch(`${_config.API_URL}/chat/messages`, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify({\n          applicationId,\n          text\n        })\n      });\n      if (res.status === 402) {\n        throw new Error(\"CHAT_LOCKED\");\n      }\n      if (res.status === 422) {\n        throw new Error(\"EMPTY_MESSAGE\");\n      }\n      if (!res.ok) {\n        throw new Error(\"FAILED_TO_SEND_MESSAGE\");\n      }\n      return yield res.json();\n    });\n    return _sendMessage.apply(this, arguments);\n  }\n  function checkChatUnlocked(_x4) {\n    return _checkChatUnlocked.apply(this, arguments);\n  }\n  function _checkChatUnlocked() {\n    _checkChatUnlocked = (0, _asyncToGenerator.default)(function* (applicationId) {\n      var headers = yield (0, _api.getAuthHeaders)();\n      var res = yield fetch(`${_config.API_URL}/applications/${applicationId}`, {\n        method: \"GET\",\n        headers\n      });\n      if (!res.ok) return false;\n      var data = yield res.json();\n      return data.chatUnlocked === true;\n    });\n    return _checkChatUnlocked.apply(this, arguments);\n  }\n});","lineCount":105,"map":[[12,2,11,0,"exports"],[12,9,11,0],[12,10,11,0,"loadMessages"],[12,22,11,0],[12,25,11,0,"loadMessages"],[12,37,11,0],[13,2,45,0,"exports"],[13,9,45,0],[13,10,45,0,"sendMessage"],[13,21,45,0],[13,24,45,0,"sendMessage"],[13,35,45,0],[14,2,75,0,"exports"],[14,9,75,0],[14,10,75,0,"checkChatUnlocked"],[14,27,75,0],[14,30,75,0,"checkChatUnlocked"],[14,47,75,0],[15,2,86,1],[15,6,86,1,"_babelRuntimeHelpersAsyncToGenerator"],[15,42,86,1],[15,45,86,1,"require"],[15,52,86,1],[15,53,86,1,"_dependencyMap"],[15,67,86,1],[16,2,86,1],[16,6,86,1,"_asyncToGenerator"],[16,23,86,1],[16,26,86,1,"_interopDefault"],[16,41,86,1],[16,42,86,1,"_babelRuntimeHelpersAsyncToGenerator"],[16,78,86,1],[17,2,3,0],[17,6,3,0,"_config"],[17,13,3,0],[17,16,3,0,"require"],[17,23,3,0],[17,24,3,0,"_dependencyMap"],[17,38,3,0],[18,2,4,0],[18,6,4,0,"_api"],[18,10,4,0],[18,13,4,0,"require"],[18,20,4,0],[18,21,4,0,"_dependencyMap"],[18,35,4,0],[19,2,1,0],[20,2,7,0],[21,0,8,0],[22,0,9,0],[23,0,10,0],[24,2,7,0],[24,11,11,22,"loadMessages"],[24,23,11,34,"loadMessages"],[24,24,11,34,"_x"],[24,26,11,34],[25,4,11,34],[25,11,11,34,"_loadMessages"],[25,24,11,34],[25,25,11,34,"apply"],[25,30,11,34],[25,37,11,34,"arguments"],[25,46,11,34],[26,2,11,34],[27,2,42,0],[28,0,43,0],[29,0,44,0],[30,2,42,0],[30,11,42,0,"_loadMessages"],[30,25,42,0],[31,4,42,0,"_loadMessages"],[31,17,42,0],[31,24,42,0,"_asyncToGenerator"],[31,41,42,0],[31,42,42,0,"default"],[31,49,42,0],[31,51,11,7],[31,62,11,35,"applicationId"],[31,75,11,56],[31,77,11,82],[32,6,12,2],[32,10,12,8,"headers"],[32,17,12,15],[32,26,12,24],[32,30,12,24,"getAuthHeaders"],[32,34,12,38],[32,35,12,38,"getAuthHeaders"],[32,49,12,38],[32,51,12,39],[32,52,12,40],[33,6,14,2],[33,10,14,8,"res"],[33,13,14,11],[33,22,14,20,"fetch"],[33,27,14,25],[33,28,14,26],[33,31,14,29,"API_URL"],[33,38,14,36],[33,39,14,36,"API_URL"],[33,46,14,36],[33,64,14,54,"applicationId"],[33,77,14,67],[33,79,14,69],[33,81,14,71],[34,8,15,4,"method"],[34,14,15,10],[34,16,15,12],[34,21,15,17],[35,8,16,4,"headers"],[36,6,17,2],[36,7,17,3],[36,8,17,4],[37,6,19,2],[37,10,19,6,"res"],[37,13,19,9],[37,14,19,10,"status"],[37,20,19,16],[37,25,19,21],[37,28,19,24],[37,30,19,26],[38,8,20,4],[38,14,20,10],[38,18,20,14,"Error"],[38,23,20,19],[38,24,20,20],[38,37,20,33],[38,38,20,34],[38,39,20,35],[38,40,20,36],[39,6,21,2],[40,6,23,2],[40,10,23,6],[40,11,23,7,"res"],[40,14,23,10],[40,15,23,11,"ok"],[40,17,23,13],[40,19,23,15],[41,8,24,4],[41,14,24,10],[41,18,24,14,"Error"],[41,23,24,19],[41,24,24,20],[41,49,24,45],[41,50,24,46],[42,6,25,2],[43,6,27,2],[43,10,27,8,"raw"],[43,13,27,11],[43,22,27,20,"res"],[43,25,27,23],[43,26,27,24,"json"],[43,30,27,28],[43,31,27,29],[43,32,27,30],[45,6,29,2],[46,6,30,2],[46,13,30,9,"raw"],[46,16,30,12],[46,17,30,13,"map"],[46,20,30,16],[46,21,30,18,"m"],[46,22,30,24],[46,27,30,30],[47,8,31,4,"id"],[47,10,31,6],[47,12,31,8,"m"],[47,13,31,9],[47,14,31,10,"id"],[47,16,31,12],[47,20,31,16,"m"],[47,21,31,17],[47,22,31,18,"_id"],[47,25,31,21],[48,8,32,4,"applicationId"],[48,21,32,17],[48,23,32,19,"m"],[48,24,32,20],[48,25,32,21,"applicationId"],[48,38,32,34],[48,42,32,38,"m"],[48,43,32,39],[48,44,32,40,"application_id"],[48,58,32,54],[49,8,33,4,"senderId"],[49,16,33,12],[49,18,33,14,"m"],[49,19,33,15],[49,20,33,16,"senderId"],[49,28,33,24],[49,32,33,28,"m"],[49,33,33,29],[49,34,33,30,"sender_id"],[49,43,33,39],[49,47,33,43,"m"],[49,48,33,44],[49,49,33,45,"fromId"],[49,55,33,51],[50,8,34,4,"senderRole"],[50,18,34,14],[50,20,34,16,"m"],[50,21,34,17],[50,22,34,18,"senderRole"],[50,32,34,28],[50,36,34,32,"m"],[50,37,34,33],[50,38,34,34,"sender_role"],[50,49,34,45],[51,8,35,4,"text"],[51,12,35,8],[51,14,35,10,"m"],[51,15,35,11],[51,16,35,12,"text"],[51,20,35,16],[51,24,35,20,"m"],[51,25,35,21],[51,26,35,22,"message"],[51,33,35,29],[51,37,35,33,"m"],[51,38,35,34],[51,39,35,35,"body"],[51,43,35,39],[51,47,35,43,"m"],[51,48,35,44],[51,49,35,45,"content"],[51,56,35,52],[51,60,35,56,"m"],[51,61,35,57],[51,62,35,58,"textBody"],[51,70,35,66],[51,74,35,70],[51,76,35,72],[52,8,36,4,"createdAt"],[52,17,36,13],[52,19,36,15,"m"],[52,20,36,16],[52,21,36,17,"createdAt"],[52,30,36,26],[52,34,36,30,"m"],[52,35,36,31],[52,36,36,32,"created_at"],[52,46,36,42],[52,50,36,46,"m"],[52,51,36,47],[52,52,36,48,"timestamp"],[52,61,36,57],[53,8,37,4,"timestamp"],[53,17,37,13],[53,19,37,15,"m"],[53,20,37,16],[53,21,37,17,"timestamp"],[53,30,37,26],[53,34,37,30,"m"],[53,35,37,31],[53,36,37,32,"createdAt"],[53,45,37,41],[53,49,37,45,"m"],[53,50,37,46],[53,51,37,47,"created_at"],[53,61,37,57],[54,8,38,4,"read"],[54,12,38,8],[54,14,38,10,"m"],[54,15,38,11],[54,16,38,12,"read"],[54,20,38,16],[54,25,38,21,"undefined"],[54,34,38,30],[54,37,38,33,"m"],[54,38,38,34],[54,39,38,35,"read"],[54,43,38,39],[54,46,38,42],[55,6,39,2],[55,7,39,3],[55,8,39,4],[55,9,39,5],[56,4,40,0],[56,5,40,1],[57,4,40,1],[57,11,40,1,"_loadMessages"],[57,24,40,1],[57,25,40,1,"apply"],[57,30,40,1],[57,37,40,1,"arguments"],[57,46,40,1],[58,2,40,1],[59,2,40,1],[59,11,45,22,"sendMessage"],[59,22,45,33,"sendMessage"],[59,23,45,33,"_x2"],[59,26,45,33],[59,28,45,33,"_x3"],[59,31,45,33],[60,4,45,33],[60,11,45,33,"_sendMessage"],[60,23,45,33],[60,24,45,33,"apply"],[60,29,45,33],[60,36,45,33,"arguments"],[60,45,45,33],[61,2,45,33],[62,2,72,0],[63,0,73,0],[64,0,74,0],[65,2,72,0],[65,11,72,0,"_sendMessage"],[65,24,72,0],[66,4,72,0,"_sendMessage"],[66,16,72,0],[66,23,72,0,"_asyncToGenerator"],[66,40,72,0],[66,41,72,0,"default"],[66,48,72,0],[66,50,45,7],[66,61,46,2,"applicationId"],[66,74,46,23],[66,76,47,2,"text"],[66,80,47,14],[66,82,48,24],[67,6,49,2],[67,10,49,8,"headers"],[67,17,49,15],[67,26,49,24],[67,30,49,24,"getAuthHeaders"],[67,34,49,38],[67,35,49,38,"getAuthHeaders"],[67,49,49,38],[67,51,49,39],[67,52,49,40],[68,6,51,2],[68,10,51,8,"res"],[68,13,51,11],[68,22,51,20,"fetch"],[68,27,51,25],[68,28,51,26],[68,31,51,29,"API_URL"],[68,38,51,36],[68,39,51,36,"API_URL"],[68,46,51,36],[68,62,51,52],[68,64,51,54],[69,8,52,4,"method"],[69,14,52,10],[69,16,52,12],[69,22,52,18],[70,8,53,4,"headers"],[70,15,53,11],[71,8,54,4,"body"],[71,12,54,8],[71,14,54,10,"JSON"],[71,18,54,14],[71,19,54,15,"stringify"],[71,28,54,24],[71,29,54,25],[72,10,54,27,"applicationId"],[72,23,54,40],[73,10,54,42,"text"],[74,8,54,47],[74,9,54,48],[75,6,55,2],[75,7,55,3],[75,8,55,4],[76,6,57,2],[76,10,57,6,"res"],[76,13,57,9],[76,14,57,10,"status"],[76,20,57,16],[76,25,57,21],[76,28,57,24],[76,30,57,26],[77,8,58,4],[77,14,58,10],[77,18,58,14,"Error"],[77,23,58,19],[77,24,58,20],[77,37,58,33],[77,38,58,34],[78,6,59,2],[79,6,61,2],[79,10,61,6,"res"],[79,13,61,9],[79,14,61,10,"status"],[79,20,61,16],[79,25,61,21],[79,28,61,24],[79,30,61,26],[80,8,62,4],[80,14,62,10],[80,18,62,14,"Error"],[80,23,62,19],[80,24,62,20],[80,39,62,35],[80,40,62,36],[81,6,63,2],[82,6,65,2],[82,10,65,6],[82,11,65,7,"res"],[82,14,65,10],[82,15,65,11,"ok"],[82,17,65,13],[82,19,65,15],[83,8,66,4],[83,14,66,10],[83,18,66,14,"Error"],[83,23,66,19],[83,24,66,20],[83,48,66,44],[83,49,66,45],[84,6,67,2],[85,6,69,2],[85,19,69,15,"res"],[85,22,69,18],[85,23,69,19,"json"],[85,27,69,23],[85,28,69,24],[85,29,69,25],[86,4,70,0],[86,5,70,1],[87,4,70,1],[87,11,70,1,"_sendMessage"],[87,23,70,1],[87,24,70,1,"apply"],[87,29,70,1],[87,36,70,1,"arguments"],[87,45,70,1],[88,2,70,1],[89,2,70,1],[89,11,75,22,"checkChatUnlocked"],[89,28,75,39,"checkChatUnlocked"],[89,29,75,39,"_x4"],[89,32,75,39],[90,4,75,39],[90,11,75,39,"_checkChatUnlocked"],[90,29,75,39],[90,30,75,39,"apply"],[90,35,75,39],[90,42,75,39,"arguments"],[90,51,75,39],[91,2,75,39],[92,2,75,39],[92,11,75,39,"_checkChatUnlocked"],[92,30,75,39],[93,4,75,39,"_checkChatUnlocked"],[93,22,75,39],[93,29,75,39,"_asyncToGenerator"],[93,46,75,39],[93,47,75,39,"default"],[93,54,75,39],[93,56,75,7],[93,67,75,40,"applicationId"],[93,80,75,61],[93,82,75,81],[94,6,76,2],[94,10,76,8,"headers"],[94,17,76,15],[94,26,76,24],[94,30,76,24,"getAuthHeaders"],[94,34,76,38],[94,35,76,38,"getAuthHeaders"],[94,49,76,38],[94,51,76,39],[94,52,76,40],[95,6,77,2],[95,10,77,8,"res"],[95,13,77,11],[95,22,77,20,"fetch"],[95,27,77,25],[95,28,77,26],[95,31,77,29,"API_URL"],[95,38,77,36],[95,39,77,36,"API_URL"],[95,46,77,36],[95,63,77,53,"applicationId"],[95,76,77,66],[95,78,77,68],[95,80,77,70],[96,8,78,4,"method"],[96,14,78,10],[96,16,78,12],[96,21,78,17],[97,8,79,4,"headers"],[98,6,80,2],[98,7,80,3],[98,8,80,4],[99,6,82,2],[99,10,82,6],[99,11,82,7,"res"],[99,14,82,10],[99,15,82,11,"ok"],[99,17,82,13],[99,19,82,15],[99,26,82,22],[99,31,82,27],[100,6,84,2],[100,10,84,8,"data"],[100,14,84,12],[100,23,84,21,"res"],[100,26,84,24],[100,27,84,25,"json"],[100,31,84,29],[100,32,84,30],[100,33,84,31],[101,6,85,2],[101,13,85,9,"data"],[101,17,85,13],[101,18,85,14,"chatUnlocked"],[101,30,85,26],[101,35,85,31],[101,39,85,35],[102,4,86,0],[102,5,86,1],[103,4,86,1],[103,11,86,1,"_checkChatUnlocked"],[103,29,86,1],[103,30,86,1,"apply"],[103,35,86,1],[103,42,86,1,"arguments"],[103,51,86,1],[104,2,86,1],[105,0,86,1],[105,3]],"functionMap":{"names":["<global>","loadMessages","raw.map$argument_0","sendMessage","checkChatUnlocked"],"mappings":"AAA;OCU;iBCmB;IDS;CDC;OGK;CHyB;OIK;CJW"},"hasCjsExports":false},"type":"js/module"}]}
{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"../config","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":36},"end":{"line":3,"column":36,"index":72}}],"key":"pHqFJJBAh3HI9ZCkK8fFRwPv3x0=","exportNames":["*"],"imports":1}},{"name":"./api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":73},"end":{"line":4,"column":39,"index":112}}],"key":"FbKPDeRJ9TF3vg1eKYKz12urgic=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.loadMessages = loadMessages;\n  exports.sendMessage = sendMessage;\n  exports.checkChatUnlocked = checkChatUnlocked;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _config = require(_dependencyMap[1], \"../config\");\n  var _api = require(_dependencyMap[2], \"./api\");\n  // app/frontend/utils/chatStore.ts\n  /**\n   * Lädt alle Nachrichten für eine Application.\n   * Chat ist nur freigeschaltet, wenn application.chatUnlocked = true.\n   */\n  function loadMessages(_x) {\n    return _loadMessages.apply(this, arguments);\n  }\n  /**\n   * Sendet Nachricht.\n   */\n  function _loadMessages() {\n    _loadMessages = (0, _asyncToGenerator.default)(function* (applicationId) {\n      var headers = yield (0, _api.getAuthHeaders)();\n      var res = yield fetch(`${_config.API_URL}/chat/messages/${applicationId}`, {\n        method: \"GET\",\n        headers\n      });\n      if (res.status === 402) {\n        throw new Error(\"CHAT_LOCKED\"); // Chat noch nicht bezahlt\n      }\n      if (!res.ok) {\n        throw new Error(\"FAILED_TO_LOAD_MESSAGES\");\n      }\n      return yield res.json();\n    });\n    return _loadMessages.apply(this, arguments);\n  }\n  function sendMessage(_x2, _x3) {\n    return _sendMessage.apply(this, arguments);\n  }\n  /**\n   * Initialer Check ob Chat freigeschaltet ist.\n   */\n  function _sendMessage() {\n    _sendMessage = (0, _asyncToGenerator.default)(function* (applicationId, text) {\n      var headers = yield (0, _api.getAuthHeaders)();\n      var res = yield fetch(`${_config.API_URL}/chat/messages`, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify({\n          applicationId,\n          text\n        })\n      });\n      if (res.status === 402) {\n        throw new Error(\"CHAT_LOCKED\");\n      }\n      if (res.status === 422) {\n        throw new Error(\"EMPTY_MESSAGE\");\n      }\n      if (!res.ok) {\n        throw new Error(\"FAILED_TO_SEND_MESSAGE\");\n      }\n      return yield res.json();\n    });\n    return _sendMessage.apply(this, arguments);\n  }\n  function checkChatUnlocked(_x4) {\n    return _checkChatUnlocked.apply(this, arguments);\n  }\n  function _checkChatUnlocked() {\n    _checkChatUnlocked = (0, _asyncToGenerator.default)(function* (applicationId) {\n      var headers = yield (0, _api.getAuthHeaders)();\n      var res = yield fetch(`${_config.API_URL}/applications/${applicationId}`, {\n        method: \"GET\",\n        headers\n      });\n      if (!res.ok) return false;\n      var data = yield res.json();\n      return data.chatUnlocked === true;\n    });\n    return _checkChatUnlocked.apply(this, arguments);\n  }\n});","lineCount":93,"map":[[12,2,11,0,"exports"],[12,9,11,0],[12,10,11,0,"loadMessages"],[12,22,11,0],[12,25,11,0,"loadMessages"],[12,37,11,0],[13,2,33,0,"exports"],[13,9,33,0],[13,10,33,0,"sendMessage"],[13,21,33,0],[13,24,33,0,"sendMessage"],[13,35,33,0],[14,2,63,0,"exports"],[14,9,63,0],[14,10,63,0,"checkChatUnlocked"],[14,27,63,0],[14,30,63,0,"checkChatUnlocked"],[14,47,63,0],[15,2,74,1],[15,6,74,1,"_babelRuntimeHelpersAsyncToGenerator"],[15,42,74,1],[15,45,74,1,"require"],[15,52,74,1],[15,53,74,1,"_dependencyMap"],[15,67,74,1],[16,2,74,1],[16,6,74,1,"_asyncToGenerator"],[16,23,74,1],[16,26,74,1,"_interopDefault"],[16,41,74,1],[16,42,74,1,"_babelRuntimeHelpersAsyncToGenerator"],[16,78,74,1],[17,2,3,0],[17,6,3,0,"_config"],[17,13,3,0],[17,16,3,0,"require"],[17,23,3,0],[17,24,3,0,"_dependencyMap"],[17,38,3,0],[18,2,4,0],[18,6,4,0,"_api"],[18,10,4,0],[18,13,4,0,"require"],[18,20,4,0],[18,21,4,0,"_dependencyMap"],[18,35,4,0],[19,2,1,0],[20,2,7,0],[21,0,8,0],[22,0,9,0],[23,0,10,0],[24,2,7,0],[24,11,11,22,"loadMessages"],[24,23,11,34,"loadMessages"],[24,24,11,34,"_x"],[24,26,11,34],[25,4,11,34],[25,11,11,34,"_loadMessages"],[25,24,11,34],[25,25,11,34,"apply"],[25,30,11,34],[25,37,11,34,"arguments"],[25,46,11,34],[26,2,11,34],[27,2,30,0],[28,0,31,0],[29,0,32,0],[30,2,30,0],[30,11,30,0,"_loadMessages"],[30,25,30,0],[31,4,30,0,"_loadMessages"],[31,17,30,0],[31,24,30,0,"_asyncToGenerator"],[31,41,30,0],[31,42,30,0,"default"],[31,49,30,0],[31,51,11,7],[31,62,11,35,"applicationId"],[31,75,11,56],[31,77,11,82],[32,6,12,2],[32,10,12,8,"headers"],[32,17,12,15],[32,26,12,24],[32,30,12,24,"getAuthHeaders"],[32,34,12,38],[32,35,12,38,"getAuthHeaders"],[32,49,12,38],[32,51,12,39],[32,52,12,40],[33,6,14,2],[33,10,14,8,"res"],[33,13,14,11],[33,22,14,20,"fetch"],[33,27,14,25],[33,28,14,26],[33,31,14,29,"API_URL"],[33,38,14,36],[33,39,14,36,"API_URL"],[33,46,14,36],[33,64,14,54,"applicationId"],[33,77,14,67],[33,79,14,69],[33,81,14,71],[34,8,15,4,"method"],[34,14,15,10],[34,16,15,12],[34,21,15,17],[35,8,16,4,"headers"],[36,6,17,2],[36,7,17,3],[36,8,17,4],[37,6,19,2],[37,10,19,6,"res"],[37,13,19,9],[37,14,19,10,"status"],[37,20,19,16],[37,25,19,21],[37,28,19,24],[37,30,19,26],[38,8,20,4],[38,14,20,10],[38,18,20,14,"Error"],[38,23,20,19],[38,24,20,20],[38,37,20,33],[38,38,20,34],[38,39,20,35],[38,40,20,36],[39,6,21,2],[40,6,23,2],[40,10,23,6],[40,11,23,7,"res"],[40,14,23,10],[40,15,23,11,"ok"],[40,17,23,13],[40,19,23,15],[41,8,24,4],[41,14,24,10],[41,18,24,14,"Error"],[41,23,24,19],[41,24,24,20],[41,49,24,45],[41,50,24,46],[42,6,25,2],[43,6,27,2],[43,19,27,15,"res"],[43,22,27,18],[43,23,27,19,"json"],[43,27,27,23],[43,28,27,24],[43,29,27,25],[44,4,28,0],[44,5,28,1],[45,4,28,1],[45,11,28,1,"_loadMessages"],[45,24,28,1],[45,25,28,1,"apply"],[45,30,28,1],[45,37,28,1,"arguments"],[45,46,28,1],[46,2,28,1],[47,2,28,1],[47,11,33,22,"sendMessage"],[47,22,33,33,"sendMessage"],[47,23,33,33,"_x2"],[47,26,33,33],[47,28,33,33,"_x3"],[47,31,33,33],[48,4,33,33],[48,11,33,33,"_sendMessage"],[48,23,33,33],[48,24,33,33,"apply"],[48,29,33,33],[48,36,33,33,"arguments"],[48,45,33,33],[49,2,33,33],[50,2,60,0],[51,0,61,0],[52,0,62,0],[53,2,60,0],[53,11,60,0,"_sendMessage"],[53,24,60,0],[54,4,60,0,"_sendMessage"],[54,16,60,0],[54,23,60,0,"_asyncToGenerator"],[54,40,60,0],[54,41,60,0,"default"],[54,48,60,0],[54,50,33,7],[54,61,34,2,"applicationId"],[54,74,34,23],[54,76,35,2,"text"],[54,80,35,14],[54,82,36,24],[55,6,37,2],[55,10,37,8,"headers"],[55,17,37,15],[55,26,37,24],[55,30,37,24,"getAuthHeaders"],[55,34,37,38],[55,35,37,38,"getAuthHeaders"],[55,49,37,38],[55,51,37,39],[55,52,37,40],[56,6,39,2],[56,10,39,8,"res"],[56,13,39,11],[56,22,39,20,"fetch"],[56,27,39,25],[56,28,39,26],[56,31,39,29,"API_URL"],[56,38,39,36],[56,39,39,36,"API_URL"],[56,46,39,36],[56,62,39,52],[56,64,39,54],[57,8,40,4,"method"],[57,14,40,10],[57,16,40,12],[57,22,40,18],[58,8,41,4,"headers"],[58,15,41,11],[59,8,42,4,"body"],[59,12,42,8],[59,14,42,10,"JSON"],[59,18,42,14],[59,19,42,15,"stringify"],[59,28,42,24],[59,29,42,25],[60,10,42,27,"applicationId"],[60,23,42,40],[61,10,42,42,"text"],[62,8,42,47],[62,9,42,48],[63,6,43,2],[63,7,43,3],[63,8,43,4],[64,6,45,2],[64,10,45,6,"res"],[64,13,45,9],[64,14,45,10,"status"],[64,20,45,16],[64,25,45,21],[64,28,45,24],[64,30,45,26],[65,8,46,4],[65,14,46,10],[65,18,46,14,"Error"],[65,23,46,19],[65,24,46,20],[65,37,46,33],[65,38,46,34],[66,6,47,2],[67,6,49,2],[67,10,49,6,"res"],[67,13,49,9],[67,14,49,10,"status"],[67,20,49,16],[67,25,49,21],[67,28,49,24],[67,30,49,26],[68,8,50,4],[68,14,50,10],[68,18,50,14,"Error"],[68,23,50,19],[68,24,50,20],[68,39,50,35],[68,40,50,36],[69,6,51,2],[70,6,53,2],[70,10,53,6],[70,11,53,7,"res"],[70,14,53,10],[70,15,53,11,"ok"],[70,17,53,13],[70,19,53,15],[71,8,54,4],[71,14,54,10],[71,18,54,14,"Error"],[71,23,54,19],[71,24,54,20],[71,48,54,44],[71,49,54,45],[72,6,55,2],[73,6,57,2],[73,19,57,15,"res"],[73,22,57,18],[73,23,57,19,"json"],[73,27,57,23],[73,28,57,24],[73,29,57,25],[74,4,58,0],[74,5,58,1],[75,4,58,1],[75,11,58,1,"_sendMessage"],[75,23,58,1],[75,24,58,1,"apply"],[75,29,58,1],[75,36,58,1,"arguments"],[75,45,58,1],[76,2,58,1],[77,2,58,1],[77,11,63,22,"checkChatUnlocked"],[77,28,63,39,"checkChatUnlocked"],[77,29,63,39,"_x4"],[77,32,63,39],[78,4,63,39],[78,11,63,39,"_checkChatUnlocked"],[78,29,63,39],[78,30,63,39,"apply"],[78,35,63,39],[78,42,63,39,"arguments"],[78,51,63,39],[79,2,63,39],[80,2,63,39],[80,11,63,39,"_checkChatUnlocked"],[80,30,63,39],[81,4,63,39,"_checkChatUnlocked"],[81,22,63,39],[81,29,63,39,"_asyncToGenerator"],[81,46,63,39],[81,47,63,39,"default"],[81,54,63,39],[81,56,63,7],[81,67,63,40,"applicationId"],[81,80,63,61],[81,82,63,81],[82,6,64,2],[82,10,64,8,"headers"],[82,17,64,15],[82,26,64,24],[82,30,64,24,"getAuthHeaders"],[82,34,64,38],[82,35,64,38,"getAuthHeaders"],[82,49,64,38],[82,51,64,39],[82,52,64,40],[83,6,65,2],[83,10,65,8,"res"],[83,13,65,11],[83,22,65,20,"fetch"],[83,27,65,25],[83,28,65,26],[83,31,65,29,"API_URL"],[83,38,65,36],[83,39,65,36,"API_URL"],[83,46,65,36],[83,63,65,53,"applicationId"],[83,76,65,66],[83,78,65,68],[83,80,65,70],[84,8,66,4,"method"],[84,14,66,10],[84,16,66,12],[84,21,66,17],[85,8,67,4,"headers"],[86,6,68,2],[86,7,68,3],[86,8,68,4],[87,6,70,2],[87,10,70,6],[87,11,70,7,"res"],[87,14,70,10],[87,15,70,11,"ok"],[87,17,70,13],[87,19,70,15],[87,26,70,22],[87,31,70,27],[88,6,72,2],[88,10,72,8,"data"],[88,14,72,12],[88,23,72,21,"res"],[88,26,72,24],[88,27,72,25,"json"],[88,31,72,29],[88,32,72,30],[88,33,72,31],[89,6,73,2],[89,13,73,9,"data"],[89,17,73,13],[89,18,73,14,"chatUnlocked"],[89,30,73,26],[89,35,73,31],[89,39,73,35],[90,4,74,0],[90,5,74,1],[91,4,74,1],[91,11,74,1,"_checkChatUnlocked"],[91,29,74,1],[91,30,74,1,"apply"],[91,35,74,1],[91,42,74,1,"arguments"],[91,51,74,1],[92,2,74,1],[93,0,74,1],[93,3]],"functionMap":{"names":["<global>","loadMessages","sendMessage","checkChatUnlocked"],"mappings":"AAA;OCU;CDiB;OEK;CFyB;OGK;CHW"},"hasCjsExports":false},"type":"js/module"}]}
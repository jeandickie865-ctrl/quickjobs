{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":83,"column":55,"index":4446}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"expo-constants","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":39,"index":39}}],"key":"2TquPknmjb1g5OMuvQ0eTuioYjU="}},{"name":"expo-modules-core","data":{"asyncType":null,"locs":[{"start":{"line":2,"column":0,"index":40},"end":{"line":2,"column":77,"index":117}}],"key":"ka0FS6s7ZmvhJq+hEjGkLLrGpyo="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.default = getDevicePushTokenAsync;\n  var _expoConstants = _interopRequireDefault(require(_dependencyMap[1], \"expo-constants\"));\n  var _expoModulesCore = require(_dependencyMap[2], \"expo-modules-core\");\n  async function getDevicePushTokenAsync() {\n    const data = await _subscribeDeviceToPushNotificationsAsync();\n    _expoModulesCore.DeviceEventEmitter.emit('onDevicePushToken', {\n      devicePushToken: data\n    });\n    return {\n      type: _expoModulesCore.Platform.OS,\n      data\n    };\n  }\n  function guardPermission() {\n    if (!('Notification' in window)) {\n      throw new _expoModulesCore.CodedError('ERR_UNAVAILABLE', 'The Web Notifications API is not available on this device.');\n    }\n    if (!navigator.serviceWorker) {\n      throw new _expoModulesCore.CodedError('ERR_UNAVAILABLE', 'Notifications cannot be used because the service worker API is not supported on this device. This might also happen because your web page does not support HTTPS.');\n    }\n    if (Notification.permission !== 'granted') {\n      throw new _expoModulesCore.CodedError('ERR_NOTIFICATIONS_PERMISSION_DENIED', `Cannot use web notifications without permissions granted. Request permissions with \"expo-permissions\".`);\n    }\n  }\n  async function _subscribeDeviceToPushNotificationsAsync() {\n    // @ts-expect-error: TODO: not on the schema\n    const vapidPublicKey = _expoConstants.default.expoConfig?.notification?.vapidPublicKey;\n    if (!vapidPublicKey) {\n      throw new _expoModulesCore.CodedError('ERR_NOTIFICATIONS_PUSH_WEB_MISSING_CONFIG', 'You must provide `notification.vapidPublicKey` in `app.json` to use push notifications on web. Learn more: https://docs.expo.dev/versions/latest/guides/using-vapid/.');\n    }\n    // @ts-expect-error: TODO: not on the schema\n    const serviceWorkerPath = _expoConstants.default.expoConfig?.notification?.serviceWorkerPath;\n    if (!serviceWorkerPath) {\n      throw new _expoModulesCore.CodedError('ERR_NOTIFICATIONS_PUSH_MISSING_CONFIGURATION', 'You must specify `notification.serviceWorkerPath` in `app.json` to use push notifications on the web. Please provide the path to the service worker that will handle notifications.');\n    }\n    guardPermission();\n    let registration = null;\n    try {\n      registration = await navigator.serviceWorker.register(serviceWorkerPath);\n    } catch (error) {\n      throw new _expoModulesCore.CodedError('ERR_NOTIFICATIONS_PUSH_REGISTRATION_FAILED', `Could not register this device for push notifications because the service worker (${serviceWorkerPath}) could not be registered: ${error}`);\n    }\n    await navigator.serviceWorker.ready;\n    if (!registration.active) {\n      throw new _expoModulesCore.CodedError('ERR_NOTIFICATIONS_PUSH_REGISTRATION_FAILED', 'Could not register this device for push notifications because the service worker is not active.');\n    }\n    const subscribeOptions = {\n      userVisibleOnly: true,\n      applicationServerKey: _urlBase64ToUint8Array(vapidPublicKey)\n    };\n    let pushSubscription = null;\n    try {\n      pushSubscription = await registration.pushManager.subscribe(subscribeOptions);\n    } catch (error) {\n      throw new _expoModulesCore.CodedError('ERR_NOTIFICATIONS_PUSH_REGISTRATION_FAILED', 'The device was unable to register for remote notifications with the browser endpoint. (' + error + ')');\n    }\n    const pushSubscriptionJson = pushSubscription.toJSON();\n    const subscriptionObject = {\n      endpoint: pushSubscriptionJson.endpoint,\n      keys: {\n        p256dh: pushSubscriptionJson.keys.p256dh,\n        auth: pushSubscriptionJson.keys.auth\n      }\n    };\n    // Store notification icon string in service worker.\n    // This message is received by `/expo-service-worker.js`.\n    // We wrap it with `fromExpoWebClient` to make sure other message\n    // will not override content such as `notificationIcon`.\n    // https://stackoverflow.com/a/35729334/2603230\n    const notificationIcon = (_expoConstants.default.expoConfig?.notification ?? {}).icon;\n    await registration.active.postMessage(JSON.stringify({\n      fromExpoWebClient: {\n        notificationIcon\n      }\n    }));\n    return subscriptionObject;\n  }\n  // https://github.com/web-push-libs/web-push#using-vapid-key-for-applicationserverkey\n  function _urlBase64ToUint8Array(base64String) {\n    const padding = '='.repeat((4 - base64String.length % 4) % 4);\n    const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');\n    const rawData = window.atob(base64);\n    const outputArray = new Uint8Array(rawData.length);\n    for (let i = 0; i < rawData.length; ++i) {\n      outputArray[i] = rawData.charCodeAt(i);\n    }\n    return outputArray;\n  }\n});","lineCount":94,"map":[[7,2,1,0],[7,6,1,0,"_expoConstants"],[7,20,1,0],[7,23,1,0,"_interopRequireDefault"],[7,45,1,0],[7,46,1,0,"require"],[7,53,1,0],[7,54,1,0,"_dependencyMap"],[7,68,1,0],[8,2,2,0],[8,6,2,0,"_expoModulesCore"],[8,22,2,0],[8,25,2,0,"require"],[8,32,2,0],[8,33,2,0,"_dependencyMap"],[8,47,2,0],[9,2,3,15],[9,17,3,30,"getDevicePushTokenAsync"],[9,40,3,53,"getDevicePushTokenAsync"],[9,41,3,53],[9,43,3,56],[10,4,4,4],[10,10,4,10,"data"],[10,14,4,14],[10,17,4,17],[10,23,4,23,"_subscribeDeviceToPushNotificationsAsync"],[10,63,4,63],[10,64,4,64],[10,65,4,65],[11,4,5,4,"DeviceEventEmitter"],[11,39,5,22],[11,40,5,23,"emit"],[11,44,5,27],[11,45,5,28],[11,64,5,47],[11,66,5,49],[12,6,5,51,"devicePushToken"],[12,21,5,66],[12,23,5,68,"data"],[13,4,5,73],[13,5,5,74],[13,6,5,75],[14,4,6,4],[14,11,6,11],[15,6,6,13,"type"],[15,10,6,17],[15,12,6,19,"Platform"],[15,37,6,27],[15,38,6,28,"OS"],[15,40,6,30],[16,6,6,32,"data"],[17,4,6,37],[17,5,6,38],[18,2,7,0],[19,2,8,0],[19,11,8,9,"guardPermission"],[19,26,8,24,"guardPermission"],[19,27,8,24],[19,29,8,27],[20,4,9,4],[20,8,9,8],[20,10,9,10],[20,24,9,24],[20,28,9,28,"window"],[20,34,9,34],[20,35,9,35],[20,37,9,37],[21,6,10,8],[21,12,10,14],[21,16,10,18,"CodedError"],[21,43,10,28],[21,44,10,29],[21,61,10,46],[21,63,10,48],[21,123,10,108],[21,124,10,109],[22,4,11,4],[23,4,12,4],[23,8,12,8],[23,9,12,9,"navigator"],[23,18,12,18],[23,19,12,19,"serviceWorker"],[23,32,12,32],[23,34,12,34],[24,6,13,8],[24,12,13,14],[24,16,13,18,"CodedError"],[24,43,13,28],[24,44,13,29],[24,61,13,46],[24,63,13,48],[24,226,13,211],[24,227,13,212],[25,4,14,4],[26,4,15,4],[26,8,15,8,"Notification"],[26,20,15,20],[26,21,15,21,"permission"],[26,31,15,31],[26,36,15,36],[26,45,15,45],[26,47,15,47],[27,6,16,8],[27,12,16,14],[27,16,16,18,"CodedError"],[27,43,16,28],[27,44,16,29],[27,81,16,66],[27,83,16,68],[27,187,16,172],[27,188,16,173],[28,4,17,4],[29,2,18,0],[30,2,19,0],[30,17,19,15,"_subscribeDeviceToPushNotificationsAsync"],[30,57,19,55,"_subscribeDeviceToPushNotificationsAsync"],[30,58,19,55],[30,60,19,58],[31,4,20,4],[32,4,21,4],[32,10,21,10,"vapidPublicKey"],[32,24,21,24],[32,27,21,27,"Constants"],[32,49,21,36],[32,50,21,37,"expoConfig"],[32,60,21,47],[32,62,21,49,"notification"],[32,74,21,61],[32,76,21,63,"vapidPublicKey"],[32,90,21,77],[33,4,22,4],[33,8,22,8],[33,9,22,9,"vapidPublicKey"],[33,23,22,23],[33,25,22,25],[34,6,23,8],[34,12,23,14],[34,16,23,18,"CodedError"],[34,43,23,28],[34,44,23,29],[34,87,23,72],[34,89,23,74],[34,256,23,241],[34,257,23,242],[35,4,24,4],[36,4,25,4],[37,4,26,4],[37,10,26,10,"serviceWorkerPath"],[37,27,26,27],[37,30,26,30,"Constants"],[37,52,26,39],[37,53,26,40,"expoConfig"],[37,63,26,50],[37,65,26,52,"notification"],[37,77,26,64],[37,79,26,66,"serviceWorkerPath"],[37,96,26,83],[38,4,27,4],[38,8,27,8],[38,9,27,9,"serviceWorkerPath"],[38,26,27,26],[38,28,27,28],[39,6,28,8],[39,12,28,14],[39,16,28,18,"CodedError"],[39,43,28,28],[39,44,28,29],[39,90,28,75],[39,92,28,77],[39,273,28,258],[39,274,28,259],[40,4,29,4],[41,4,30,4,"guardPermission"],[41,19,30,19],[41,20,30,20],[41,21,30,21],[42,4,31,4],[42,8,31,8,"registration"],[42,20,31,20],[42,23,31,23],[42,27,31,27],[43,4,32,4],[43,8,32,8],[44,6,33,8,"registration"],[44,18,33,20],[44,21,33,23],[44,27,33,29,"navigator"],[44,36,33,38],[44,37,33,39,"serviceWorker"],[44,50,33,52],[44,51,33,53,"register"],[44,59,33,61],[44,60,33,62,"serviceWorkerPath"],[44,77,33,79],[44,78,33,80],[45,4,34,4],[45,5,34,5],[45,6,35,4],[45,13,35,11,"error"],[45,18,35,16],[45,20,35,18],[46,6,36,8],[46,12,36,14],[46,16,36,18,"CodedError"],[46,43,36,28],[46,44,36,29],[46,88,36,73],[46,90,36,75],[46,175,36,160,"serviceWorkerPath"],[46,192,36,177],[46,222,36,207,"error"],[46,227,36,212],[46,229,36,214],[46,230,36,215],[47,4,37,4],[48,4,38,4],[48,10,38,10,"navigator"],[48,19,38,19],[48,20,38,20,"serviceWorker"],[48,33,38,33],[48,34,38,34,"ready"],[48,39,38,39],[49,4,39,4],[49,8,39,8],[49,9,39,9,"registration"],[49,21,39,21],[49,22,39,22,"active"],[49,28,39,28],[49,30,39,30],[50,6,40,8],[50,12,40,14],[50,16,40,18,"CodedError"],[50,43,40,28],[50,44,40,29],[50,88,40,73],[50,90,40,75],[50,187,40,172],[50,188,40,173],[51,4,41,4],[52,4,42,4],[52,10,42,10,"subscribeOptions"],[52,26,42,26],[52,29,42,29],[53,6,43,8,"userVisibleOnly"],[53,21,43,23],[53,23,43,25],[53,27,43,29],[54,6,44,8,"applicationServerKey"],[54,26,44,28],[54,28,44,30,"_urlBase64ToUint8Array"],[54,50,44,52],[54,51,44,53,"vapidPublicKey"],[54,65,44,67],[55,4,45,4],[55,5,45,5],[56,4,46,4],[56,8,46,8,"pushSubscription"],[56,24,46,24],[56,27,46,27],[56,31,46,31],[57,4,47,4],[57,8,47,8],[58,6,48,8,"pushSubscription"],[58,22,48,24],[58,25,48,27],[58,31,48,33,"registration"],[58,43,48,45],[58,44,48,46,"pushManager"],[58,55,48,57],[58,56,48,58,"subscribe"],[58,65,48,67],[58,66,48,68,"subscribeOptions"],[58,82,48,84],[58,83,48,85],[59,4,49,4],[59,5,49,5],[59,6,50,4],[59,13,50,11,"error"],[59,18,50,16],[59,20,50,18],[60,6,51,8],[60,12,51,14],[60,16,51,18,"CodedError"],[60,43,51,28],[60,44,51,29],[60,88,51,73],[60,90,51,75],[60,179,51,164],[60,182,52,12,"error"],[60,187,52,17],[60,190,53,12],[60,193,53,15],[60,194,53,16],[61,4,54,4],[62,4,55,4],[62,10,55,10,"pushSubscriptionJson"],[62,30,55,30],[62,33,55,33,"pushSubscription"],[62,49,55,49],[62,50,55,50,"toJSON"],[62,56,55,56],[62,57,55,57],[62,58,55,58],[63,4,56,4],[63,10,56,10,"subscriptionObject"],[63,28,56,28],[63,31,56,31],[64,6,57,8,"endpoint"],[64,14,57,16],[64,16,57,18,"pushSubscriptionJson"],[64,36,57,38],[64,37,57,39,"endpoint"],[64,45,57,47],[65,6,58,8,"keys"],[65,10,58,12],[65,12,58,14],[66,8,59,12,"p256dh"],[66,14,59,18],[66,16,59,20,"pushSubscriptionJson"],[66,36,59,40],[66,37,59,41,"keys"],[66,41,59,45],[66,42,59,46,"p256dh"],[66,48,59,52],[67,8,60,12,"auth"],[67,12,60,16],[67,14,60,18,"pushSubscriptionJson"],[67,34,60,38],[67,35,60,39,"keys"],[67,39,60,43],[67,40,60,44,"auth"],[68,6,61,8],[69,4,62,4],[69,5,62,5],[70,4,63,4],[71,4,64,4],[72,4,65,4],[73,4,66,4],[74,4,67,4],[75,4,68,4],[75,10,68,10,"notificationIcon"],[75,26,68,26],[75,29,68,29],[75,30,68,30,"Constants"],[75,52,68,39],[75,53,68,40,"expoConfig"],[75,63,68,50],[75,65,68,52,"notification"],[75,77,68,64],[75,81,68,68],[75,82,68,69],[75,83,68,70],[75,85,68,72,"icon"],[75,89,68,76],[76,4,69,4],[76,10,69,10,"registration"],[76,22,69,22],[76,23,69,23,"active"],[76,29,69,29],[76,30,69,30,"postMessage"],[76,41,69,41],[76,42,69,42,"JSON"],[76,46,69,46],[76,47,69,47,"stringify"],[76,56,69,56],[76,57,69,57],[77,6,69,59,"fromExpoWebClient"],[77,23,69,76],[77,25,69,78],[78,8,69,80,"notificationIcon"],[79,6,69,97],[80,4,69,99],[80,5,69,100],[80,6,69,101],[80,7,69,102],[81,4,70,4],[81,11,70,11,"subscriptionObject"],[81,29,70,29],[82,2,71,0],[83,2,72,0],[84,2,73,0],[84,11,73,9,"_urlBase64ToUint8Array"],[84,33,73,31,"_urlBase64ToUint8Array"],[84,34,73,32,"base64String"],[84,46,73,44],[84,48,73,46],[85,4,74,4],[85,10,74,10,"padding"],[85,17,74,17],[85,20,74,20],[85,23,74,23],[85,24,74,24,"repeat"],[85,30,74,30],[85,31,74,31],[85,32,74,32],[85,33,74,33],[85,36,74,37,"base64String"],[85,48,74,49],[85,49,74,50,"length"],[85,55,74,56],[85,58,74,59],[85,59,74,61],[85,63,74,65],[85,64,74,66],[85,65,74,67],[86,4,75,4],[86,10,75,10,"base64"],[86,16,75,16],[86,19,75,19],[86,20,75,20,"base64String"],[86,32,75,32],[86,35,75,35,"padding"],[86,42,75,42],[86,44,75,44,"replace"],[86,51,75,51],[86,52,75,52],[86,56,75,56],[86,58,75,58],[86,61,75,61],[86,62,75,62],[86,63,75,63,"replace"],[86,70,75,70],[86,71,75,71],[86,75,75,75],[86,77,75,77],[86,80,75,80],[86,81,75,81],[87,4,76,4],[87,10,76,10,"rawData"],[87,17,76,17],[87,20,76,20,"window"],[87,26,76,26],[87,27,76,27,"atob"],[87,31,76,31],[87,32,76,32,"base64"],[87,38,76,38],[87,39,76,39],[88,4,77,4],[88,10,77,10,"outputArray"],[88,21,77,21],[88,24,77,24],[88,28,77,28,"Uint8Array"],[88,38,77,38],[88,39,77,39,"rawData"],[88,46,77,46],[88,47,77,47,"length"],[88,53,77,53],[88,54,77,54],[89,4,78,4],[89,9,78,9],[89,13,78,13,"i"],[89,14,78,14],[89,17,78,17],[89,18,78,18],[89,20,78,20,"i"],[89,21,78,21],[89,24,78,24,"rawData"],[89,31,78,31],[89,32,78,32,"length"],[89,38,78,38],[89,40,78,40],[89,42,78,42,"i"],[89,43,78,43],[89,45,78,45],[90,6,79,8,"outputArray"],[90,17,79,19],[90,18,79,20,"i"],[90,19,79,21],[90,20,79,22],[90,23,79,25,"rawData"],[90,30,79,32],[90,31,79,33,"charCodeAt"],[90,41,79,43],[90,42,79,44,"i"],[90,43,79,45],[90,44,79,46],[91,4,80,4],[92,4,81,4],[92,11,81,11,"outputArray"],[92,22,81,22],[93,2,82,0],[94,0,82,1]],"functionMap":{"names":["<global>","getDevicePushTokenAsync","guardPermission","_subscribeDeviceToPushNotificationsAsync","_urlBase64ToUint8Array"],"mappings":"AAA;eCE;CDI;AEC;CFU;AGC;CHoD;AIE;CJS"}},"type":"js/module"}]}
{"dependencies":[{"name":"../config","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":36},"end":{"line":3,"column":36,"index":72}}],"key":"pHqFJJBAh3HI9ZCkK8fFRwPv3x0=","exportNames":["*"],"imports":1}},{"name":"./api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":73},"end":{"line":4,"column":39,"index":112}}],"key":"FbKPDeRJ9TF3vg1eKYKz12urgic=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.loadMessages = loadMessages;\n  exports.sendMessage = sendMessage;\n  exports.checkChatUnlocked = checkChatUnlocked;\n  var _config = require(_dependencyMap[0], \"../config\");\n  var _api = require(_dependencyMap[1], \"./api\");\n  // app/frontend/utils/chatStore.ts\n\n  /**\n   * Lädt alle Nachrichten für eine Application.\n   * Chat ist nur freigeschaltet, wenn application.chatUnlocked = true.\n   */\n  async function loadMessages(applicationId) {\n    const headers = await (0, _api.getAuthHeaders)();\n    const res = await fetch(`${_config.API_URL}/chat/messages/${applicationId}`, {\n      method: \"GET\",\n      headers\n    });\n    if (res.status === 402) {\n      throw new Error(\"CHAT_LOCKED\"); // Chat noch nicht bezahlt\n    }\n    if (!res.ok) {\n      throw new Error(\"FAILED_TO_LOAD_MESSAGES\");\n    }\n    return await res.json();\n  }\n\n  /**\n   * Sendet Nachricht.\n   */\n  async function sendMessage(applicationId, text) {\n    const headers = await (0, _api.getAuthHeaders)();\n    const res = await fetch(`${_config.API_URL}/chat/messages`, {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify({\n        applicationId,\n        text\n      })\n    });\n    if (res.status === 402) {\n      throw new Error(\"CHAT_LOCKED\");\n    }\n    if (res.status === 422) {\n      throw new Error(\"EMPTY_MESSAGE\");\n    }\n    if (!res.ok) {\n      throw new Error(\"FAILED_TO_SEND_MESSAGE\");\n    }\n    return await res.json();\n  }\n\n  /**\n   * Initialer Check ob Chat freigeschaltet ist.\n   */\n  async function checkChatUnlocked(applicationId) {\n    const headers = await (0, _api.getAuthHeaders)();\n    const res = await fetch(`${_config.API_URL}/applications/${applicationId}`, {\n      method: \"GET\",\n      headers\n    });\n    if (!res.ok) return false;\n    const data = await res.json();\n    return data.chatUnlocked === true;\n  }\n});","lineCount":71,"map":[[7,2,11,0,"exports"],[7,9,11,0],[7,10,11,0,"loadMessages"],[7,22,11,0],[7,25,11,0,"loadMessages"],[7,37,11,0],[8,2,33,0,"exports"],[8,9,33,0],[8,10,33,0,"sendMessage"],[8,21,33,0],[8,24,33,0,"sendMessage"],[8,35,33,0],[9,2,63,0,"exports"],[9,9,63,0],[9,10,63,0,"checkChatUnlocked"],[9,27,63,0],[9,30,63,0,"checkChatUnlocked"],[9,47,63,0],[10,2,3,0],[10,6,3,0,"_config"],[10,13,3,0],[10,16,3,0,"require"],[10,23,3,0],[10,24,3,0,"_dependencyMap"],[10,38,3,0],[11,2,4,0],[11,6,4,0,"_api"],[11,10,4,0],[11,13,4,0,"require"],[11,20,4,0],[11,21,4,0,"_dependencyMap"],[11,35,4,0],[12,2,1,0],[14,2,7,0],[15,0,8,0],[16,0,9,0],[17,0,10,0],[18,2,11,7],[18,17,11,22,"loadMessages"],[18,29,11,34,"loadMessages"],[18,30,11,35,"applicationId"],[18,43,11,56],[18,45,11,82],[19,4,12,2],[19,10,12,8,"headers"],[19,17,12,15],[19,20,12,18],[19,26,12,24],[19,30,12,24,"getAuthHeaders"],[19,34,12,38],[19,35,12,38,"getAuthHeaders"],[19,49,12,38],[19,51,12,39],[19,52,12,40],[20,4,14,2],[20,10,14,8,"res"],[20,13,14,11],[20,16,14,14],[20,22,14,20,"fetch"],[20,27,14,25],[20,28,14,26],[20,31,14,29,"API_URL"],[20,38,14,36],[20,39,14,36,"API_URL"],[20,46,14,36],[20,64,14,54,"applicationId"],[20,77,14,67],[20,79,14,69],[20,81,14,71],[21,6,15,4,"method"],[21,12,15,10],[21,14,15,12],[21,19,15,17],[22,6,16,4,"headers"],[23,4,17,2],[23,5,17,3],[23,6,17,4],[24,4,19,2],[24,8,19,6,"res"],[24,11,19,9],[24,12,19,10,"status"],[24,18,19,16],[24,23,19,21],[24,26,19,24],[24,28,19,26],[25,6,20,4],[25,12,20,10],[25,16,20,14,"Error"],[25,21,20,19],[25,22,20,20],[25,35,20,33],[25,36,20,34],[25,37,20,35],[25,38,20,36],[26,4,21,2],[27,4,23,2],[27,8,23,6],[27,9,23,7,"res"],[27,12,23,10],[27,13,23,11,"ok"],[27,15,23,13],[27,17,23,15],[28,6,24,4],[28,12,24,10],[28,16,24,14,"Error"],[28,21,24,19],[28,22,24,20],[28,47,24,45],[28,48,24,46],[29,4,25,2],[30,4,27,2],[30,11,27,9],[30,17,27,15,"res"],[30,20,27,18],[30,21,27,19,"json"],[30,25,27,23],[30,26,27,24],[30,27,27,25],[31,2,28,0],[33,2,30,0],[34,0,31,0],[35,0,32,0],[36,2,33,7],[36,17,33,22,"sendMessage"],[36,28,33,33,"sendMessage"],[36,29,34,2,"applicationId"],[36,42,34,23],[36,44,35,2,"text"],[36,48,35,14],[36,50,36,24],[37,4,37,2],[37,10,37,8,"headers"],[37,17,37,15],[37,20,37,18],[37,26,37,24],[37,30,37,24,"getAuthHeaders"],[37,34,37,38],[37,35,37,38,"getAuthHeaders"],[37,49,37,38],[37,51,37,39],[37,52,37,40],[38,4,39,2],[38,10,39,8,"res"],[38,13,39,11],[38,16,39,14],[38,22,39,20,"fetch"],[38,27,39,25],[38,28,39,26],[38,31,39,29,"API_URL"],[38,38,39,36],[38,39,39,36,"API_URL"],[38,46,39,36],[38,62,39,52],[38,64,39,54],[39,6,40,4,"method"],[39,12,40,10],[39,14,40,12],[39,20,40,18],[40,6,41,4,"headers"],[40,13,41,11],[41,6,42,4,"body"],[41,10,42,8],[41,12,42,10,"JSON"],[41,16,42,14],[41,17,42,15,"stringify"],[41,26,42,24],[41,27,42,25],[42,8,42,27,"applicationId"],[42,21,42,40],[43,8,42,42,"text"],[44,6,42,47],[44,7,42,48],[45,4,43,2],[45,5,43,3],[45,6,43,4],[46,4,45,2],[46,8,45,6,"res"],[46,11,45,9],[46,12,45,10,"status"],[46,18,45,16],[46,23,45,21],[46,26,45,24],[46,28,45,26],[47,6,46,4],[47,12,46,10],[47,16,46,14,"Error"],[47,21,46,19],[47,22,46,20],[47,35,46,33],[47,36,46,34],[48,4,47,2],[49,4,49,2],[49,8,49,6,"res"],[49,11,49,9],[49,12,49,10,"status"],[49,18,49,16],[49,23,49,21],[49,26,49,24],[49,28,49,26],[50,6,50,4],[50,12,50,10],[50,16,50,14,"Error"],[50,21,50,19],[50,22,50,20],[50,37,50,35],[50,38,50,36],[51,4,51,2],[52,4,53,2],[52,8,53,6],[52,9,53,7,"res"],[52,12,53,10],[52,13,53,11,"ok"],[52,15,53,13],[52,17,53,15],[53,6,54,4],[53,12,54,10],[53,16,54,14,"Error"],[53,21,54,19],[53,22,54,20],[53,46,54,44],[53,47,54,45],[54,4,55,2],[55,4,57,2],[55,11,57,9],[55,17,57,15,"res"],[55,20,57,18],[55,21,57,19,"json"],[55,25,57,23],[55,26,57,24],[55,27,57,25],[56,2,58,0],[58,2,60,0],[59,0,61,0],[60,0,62,0],[61,2,63,7],[61,17,63,22,"checkChatUnlocked"],[61,34,63,39,"checkChatUnlocked"],[61,35,63,40,"applicationId"],[61,48,63,61],[61,50,63,81],[62,4,64,2],[62,10,64,8,"headers"],[62,17,64,15],[62,20,64,18],[62,26,64,24],[62,30,64,24,"getAuthHeaders"],[62,34,64,38],[62,35,64,38,"getAuthHeaders"],[62,49,64,38],[62,51,64,39],[62,52,64,40],[63,4,65,2],[63,10,65,8,"res"],[63,13,65,11],[63,16,65,14],[63,22,65,20,"fetch"],[63,27,65,25],[63,28,65,26],[63,31,65,29,"API_URL"],[63,38,65,36],[63,39,65,36,"API_URL"],[63,46,65,36],[63,63,65,53,"applicationId"],[63,76,65,66],[63,78,65,68],[63,80,65,70],[64,6,66,4,"method"],[64,12,66,10],[64,14,66,12],[64,19,66,17],[65,6,67,4,"headers"],[66,4,68,2],[66,5,68,3],[66,6,68,4],[67,4,70,2],[67,8,70,6],[67,9,70,7,"res"],[67,12,70,10],[67,13,70,11,"ok"],[67,15,70,13],[67,17,70,15],[67,24,70,22],[67,29,70,27],[68,4,72,2],[68,10,72,8,"data"],[68,14,72,12],[68,17,72,15],[68,23,72,21,"res"],[68,26,72,24],[68,27,72,25,"json"],[68,31,72,29],[68,32,72,30],[68,33,72,31],[69,4,73,2],[69,11,73,9,"data"],[69,15,73,13],[69,16,73,14,"chatUnlocked"],[69,28,73,26],[69,33,73,31],[69,37,73,35],[70,2,74,0],[71,0,74,1],[71,3]],"functionMap":{"names":["<global>","loadMessages","sendMessage","checkChatUnlocked"],"mappings":"AAA;OCU;CDiB;OEK;CFyB;OGK;CHW"},"hasCjsExports":false},"type":"js/module"}]}